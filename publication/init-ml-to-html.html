<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pierre Jaumier">
<meta name="dcterms.date" content="2024-10-07">

<title>Initiation au machine learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="init-ml-to-html_files/libs/clipboard/clipboard.min.js"></script>
<script src="init-ml-to-html_files/libs/quarto-html/quarto.js"></script>
<script src="init-ml-to-html_files/libs/quarto-html/popper.min.js"></script>
<script src="init-ml-to-html_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="init-ml-to-html_files/libs/quarto-html/anchor.min.js"></script>
<link href="init-ml-to-html_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="init-ml-to-html_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="init-ml-to-html_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="init-ml-to-html_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="init-ml-to-html_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#algorithme-des-plus-proches-voisins" id="toc-algorithme-des-plus-proches-voisins" class="nav-link active" data-scroll-target="#algorithme-des-plus-proches-voisins"><span class="header-section-number">1</span> Algorithme des plus proches voisins</a>
  <ul class="collapse">
  <li><a href="#génération-de-données-dexemple" id="toc-génération-de-données-dexemple" class="nav-link" data-scroll-target="#génération-de-données-dexemple"><span class="header-section-number">1.1</span> Génération de données d’exemple</a></li>
  <li><a href="#visualisation" id="toc-visualisation" class="nav-link" data-scroll-target="#visualisation"><span class="header-section-number">1.2</span> Visualisation</a>
  <ul class="collapse">
  <li><a href="#classification-dun-nouveau-point-pris-au-hasard" id="toc-classification-dun-nouveau-point-pris-au-hasard" class="nav-link" data-scroll-target="#classification-dun-nouveau-point-pris-au-hasard"><span class="header-section-number">1.2.1</span> Classification d’un nouveau point pris au hasard</a></li>
  <li><a href="#jeu-de-données-initial-et-étiquettes-associées" id="toc-jeu-de-données-initial-et-étiquettes-associées" class="nav-link" data-scroll-target="#jeu-de-données-initial-et-étiquettes-associées"><span class="header-section-number">1.2.2</span> Jeu de données initial et étiquettes associées</a></li>
  <li><a href="#etapes-de-lalgorithme" id="toc-etapes-de-lalgorithme" class="nav-link" data-scroll-target="#etapes-de-lalgorithme"><span class="header-section-number">1.2.3</span> Etapes de l’algorithme</a></li>
  </ul></li>
  <li><a href="#fonction-knn" id="toc-fonction-knn" class="nav-link" data-scroll-target="#fonction-knn"><span class="header-section-number">1.3</span> Fonction kNN</a></li>
  <li><a href="#références" id="toc-références" class="nav-link" data-scroll-target="#références"><span class="header-section-number">1.4</span> Références</a></li>
  </ul></li>
  <li><a href="#normalisation" id="toc-normalisation" class="nav-link" data-scroll-target="#normalisation"><span class="header-section-number">2</span> Normalisation</a>
  <ul class="collapse">
  <li><a href="#normalisation-motivation" id="toc-normalisation-motivation" class="nav-link" data-scroll-target="#normalisation-motivation"><span class="header-section-number">2.1</span> Normalisation: motivation</a></li>
  <li><a href="#moyenne-variance-et-écart-type" id="toc-moyenne-variance-et-écart-type" class="nav-link" data-scroll-target="#moyenne-variance-et-écart-type"><span class="header-section-number">2.2</span> Moyenne, variance et écart type</a></li>
  <li><a href="#normalisation-standard" id="toc-normalisation-standard" class="nav-link" data-scroll-target="#normalisation-standard"><span class="header-section-number">2.3</span> Normalisation standard</a></li>
  <li><a href="#knn-sur-données-normalisées" id="toc-knn-sur-données-normalisées" class="nav-link" data-scroll-target="#knn-sur-données-normalisées"><span class="header-section-number">2.4</span> kNN sur données normalisées</a></li>
  </ul></li>
  <li><a href="#parallèle-avec-scikit-learn" id="toc-parallèle-avec-scikit-learn" class="nav-link" data-scroll-target="#parallèle-avec-scikit-learn"><span class="header-section-number">3</span> Parallèle avec scikit learn</a>
  <ul class="collapse">
  <li><a href="#nomenclature" id="toc-nomenclature" class="nav-link" data-scroll-target="#nomenclature"><span class="header-section-number">3.1</span> Nomenclature</a></li>
  <li><a href="#standardisation" id="toc-standardisation" class="nav-link" data-scroll-target="#standardisation"><span class="header-section-number">3.2</span> Standardisation</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">3.3</span> Classification</a></li>
  </ul></li>
  <li><a href="#application-à-un-vrai-jeu-de-données" id="toc-application-à-un-vrai-jeu-de-données" class="nav-link" data-scroll-target="#application-à-un-vrai-jeu-de-données"><span class="header-section-number">4</span> Application à un vrai jeu de données</a>
  <ul class="collapse">
  <li><a href="#séparation-du-jeu-de-données-en-données-dentraînement-et-données-de-test" id="toc-séparation-du-jeu-de-données-en-données-dentraînement-et-données-de-test" class="nav-link" data-scroll-target="#séparation-du-jeu-de-données-en-données-dentraînement-et-données-de-test"><span class="header-section-number">4.1</span> Séparation du jeu de données en données d’entraînement et données de test</a>
  <ul class="collapse">
  <li><a href="#solution-avec-random.shufflex" id="toc-solution-avec-random.shufflex" class="nav-link" data-scroll-target="#solution-avec-random.shufflex"><span class="header-section-number">4.1.1</span> Solution avec random.shuffle(x)</a></li>
  <li><a href="#solution-avec-random.sample" id="toc-solution-avec-random.sample" class="nav-link" data-scroll-target="#solution-avec-random.sample"><span class="header-section-number">4.1.2</span> Solution avec random.sample()</a></li>
  </ul></li>
  <li><a href="#notre-implémentation-des-algorithmes" id="toc-notre-implémentation-des-algorithmes" class="nav-link" data-scroll-target="#notre-implémentation-des-algorithmes"><span class="header-section-number">4.2</span> Notre implémentation des algorithmes</a>
  <ul class="collapse">
  <li><a href="#sans-normalisation" id="toc-sans-normalisation" class="nav-link" data-scroll-target="#sans-normalisation"><span class="header-section-number">4.2.1</span> Sans normalisation</a></li>
  <li><a href="#avec-normalisation" id="toc-avec-normalisation" class="nav-link" data-scroll-target="#avec-normalisation"><span class="header-section-number">4.2.2</span> Avec normalisation</a></li>
  <li><a href="#quelle-mesure-pour-la-pertinence-de-notre-algorithme" id="toc-quelle-mesure-pour-la-pertinence-de-notre-algorithme" class="nav-link" data-scroll-target="#quelle-mesure-pour-la-pertinence-de-notre-algorithme"><span class="header-section-number">4.2.3</span> Quelle mesure pour la pertinence de notre algorithme?</a></li>
  </ul></li>
  <li><a href="#avec-scikit-learn" id="toc-avec-scikit-learn" class="nav-link" data-scroll-target="#avec-scikit-learn"><span class="header-section-number">4.3</span> Avec scikit-learn</a>
  <ul class="collapse">
  <li><a href="#k1-sans-normalisation" id="toc-k1-sans-normalisation" class="nav-link" data-scroll-target="#k1-sans-normalisation"><span class="header-section-number">4.3.1</span> k=1 sans normalisation</a></li>
  <li><a href="#k1-avec-normalisation" id="toc-k1-avec-normalisation" class="nav-link" data-scroll-target="#k1-avec-normalisation"><span class="header-section-number">4.3.2</span> k=1 avec normalisation</a></li>
  <li><a href="#k3-sans-normalisation" id="toc-k3-sans-normalisation" class="nav-link" data-scroll-target="#k3-sans-normalisation"><span class="header-section-number">4.3.3</span> k=3 sans normalisation</a></li>
  <li><a href="#k3-avec-normalisation" id="toc-k3-avec-normalisation" class="nav-link" data-scroll-target="#k3-avec-normalisation"><span class="header-section-number">4.3.4</span> k=3 avec normalisation</a></li>
  </ul></li>
  <li><a href="#références-1" id="toc-références-1" class="nav-link" data-scroll-target="#références-1"><span class="header-section-number">4.4</span> Références</a></li>
  </ul></li>
  <li><a href="#arbres-de-décision" id="toc-arbres-de-décision" class="nav-link" data-scroll-target="#arbres-de-décision"><span class="header-section-number">5</span> Arbres de décision</a>
  <ul class="collapse">
  <li><a href="#création-du-jeu-de-données-exemple" id="toc-création-du-jeu-de-données-exemple" class="nav-link" data-scroll-target="#création-du-jeu-de-données-exemple"><span class="header-section-number">5.1</span> Création du jeu de données exemple</a></li>
  <li><a href="#représentation-graphique-des-premières-séparations" id="toc-représentation-graphique-des-premières-séparations" class="nav-link" data-scroll-target="#représentation-graphique-des-premières-séparations"><span class="header-section-number">5.2</span> Représentation graphique des premières séparations</a>
  <ul class="collapse">
  <li><a href="#région-condidérée-ensemble-des-points" id="toc-région-condidérée-ensemble-des-points" class="nav-link" data-scroll-target="#région-condidérée-ensemble-des-points"><span class="header-section-number">5.2.1</span> Région condidérée: ensemble des points</a></li>
  <li><a href="#région-r1-classée-en-bleu" id="toc-région-r1-classée-en-bleu" class="nav-link" data-scroll-target="#région-r1-classée-en-bleu"><span class="header-section-number">5.2.2</span> Région R1 classée en bleu</a></li>
  <li><a href="#région-r2-classée-en-rouge" id="toc-région-r2-classée-en-rouge" class="nav-link" data-scroll-target="#région-r2-classée-en-rouge"><span class="header-section-number">5.2.3</span> Région R2 classée en rouge</a></li>
  <li><a href="#arbre-de-hauteur-1" id="toc-arbre-de-hauteur-1" class="nav-link" data-scroll-target="#arbre-de-hauteur-1"><span class="header-section-number">5.2.4</span> Arbre de hauteur 1</a></li>
  <li><a href="#arbre-de-hauteur-2" id="toc-arbre-de-hauteur-2" class="nav-link" data-scroll-target="#arbre-de-hauteur-2"><span class="header-section-number">5.2.5</span> Arbre de hauteur 2</a></li>
  </ul></li>
  <li><a href="#classification-avec-scikit-learn" id="toc-classification-avec-scikit-learn" class="nav-link" data-scroll-target="#classification-avec-scikit-learn"><span class="header-section-number">5.3</span> Classification avec scikit learn</a></li>
  </ul></li>
  <li><a href="#application-des-arbres-de-décision-à-un-vrai-jeu-de-données" id="toc-application-des-arbres-de-décision-à-un-vrai-jeu-de-données" class="nav-link" data-scroll-target="#application-des-arbres-de-décision-à-un-vrai-jeu-de-données"><span class="header-section-number">6</span> Application des arbres de décision à un vrai jeu de données</a>
  <ul class="collapse">
  <li><a href="#classification-de-référence-baseline" id="toc-classification-de-référence-baseline" class="nav-link" data-scroll-target="#classification-de-référence-baseline"><span class="header-section-number">6.1</span> Classification de référence (baseline)</a></li>
  <li><a href="#exploration-des-hyperparamètres" id="toc-exploration-des-hyperparamètres" class="nav-link" data-scroll-target="#exploration-des-hyperparamètres"><span class="header-section-number">6.2</span> Exploration des hyperparamètres</a></li>
  <li><a href="#meilleur-résultat" id="toc-meilleur-résultat" class="nav-link" data-scroll-target="#meilleur-résultat"><span class="header-section-number">6.3</span> Meilleur résultat</a></li>
  <li><a href="#affinons-la-solution" id="toc-affinons-la-solution" class="nav-link" data-scroll-target="#affinons-la-solution"><span class="header-section-number">6.4</span> Affinons la solution</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Initiation au machine learning</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Pierre Jaumier </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">10/07/2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<p>Initiation au machine learning</p>
<p>Supports pour le cours d’initiation au machine learning proposé sur une semaine de formation.</p>
<section id="algorithme-des-plus-proches-voisins" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Algorithme des plus proches voisins</h1>
<p>knn : k nearest neighbors</p>
<section id="génération-de-données-dexemple" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="génération-de-données-dexemple"><span class="header-section-number">1.1</span> Génération de données d’exemple</h2>
<div id="8f4a6f58-64e3-4aab-982d-60df72386a97" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>points_bleus <span class="op">=</span> []</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>points_rouges <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dans un premier exemple les points au dessus de la diagonale sont bleus et ceux en dessous sont rouges.</p>
<p>Générer les coordonnées des différents points <span class="math inline">\((x,y)\)</span>, comprises entre 0 et 100.</p>
<p><a href="https://docs.python.org/3/library/random.html">random — Generate pseudo-random numbers</a></p>
<pre><code>random.randint(a, b)
Return a random integer N such that a &lt;= N &lt;= b. Alias for randrange(a, b+1).</code></pre>
<div id="3f0209ee-1754-4a3c-ac64-33d76c77474e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>random.randint(<span class="dv">0</span>,<span class="dv">100</span>), random.randint(<span class="dv">0</span>,<span class="dv">100</span>), random.randint(<span class="dv">0</span>,<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>(31, 48, 59)</code></pre>
</div>
</div>
<div id="bf6aa587-4564-45ff-b8af-86d5e3eaee14" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>random.randint(<span class="dv">0</span>,<span class="dv">100</span>), random.randint(<span class="dv">0</span>,<span class="dv">100</span>), random.randint(<span class="dv">0</span>,<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(81, 14, 3)</code></pre>
</div>
</div>
<div id="3ed1d00d-1bbf-4518-906b-d5a22dba2a9b" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>random.randint(<span class="dv">0</span>,<span class="dv">100</span>), random.randint(<span class="dv">0</span>,<span class="dv">100</span>), random.randint(<span class="dv">0</span>,<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>(94, 35, 31)</code></pre>
</div>
</div>
<div id="dfe6fdff-180c-4931-a4dc-704f06995144" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>random.randint(<span class="dv">0</span>,<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>28</code></pre>
</div>
</div>
<p>Génération de 10 points de chaque couleur:</p>
<div id="a82e40c4-1c3a-4295-ac78-f523be82eda9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10</span>  <span class="co"># Nombre de points par couleur</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="bu">len</span>(points_bleus)<span class="op">!=</span>n <span class="kw">or</span> <span class="bu">len</span>(points_rouges)<span class="op">!=</span>n:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> random.randint(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> random.randint(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="op">&gt;=</span> x <span class="kw">and</span> <span class="bu">len</span>(points_bleus) <span class="op">&lt;</span> n:</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        points_bleus.append((x,y))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> y <span class="op">&lt;</span> x <span class="kw">and</span> <span class="bu">len</span>(points_rouges) <span class="op">&lt;</span> n:</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        points_rouges.append((x,y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="87cb6974-8343-4a1e-9b29-9239a3db03d9" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>points_bleus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>[(3, 94),
 (86, 94),
 (11, 27),
 (29, 64),
 (57, 75),
 (19, 27),
 (5, 93),
 (58, 68),
 (15, 48),
 (10, 70)]</code></pre>
</div>
</div>
<div id="ae75433b-317c-43d1-b2ef-ee30cf470df0" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>points_rouges</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>[(81, 14),
 (35, 31),
 (28, 17),
 (94, 13),
 (69, 11),
 (75, 54),
 (4, 3),
 (77, 3),
 (71, 25),
 (91, 83)]</code></pre>
</div>
</div>
</section>
<section id="visualisation" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="visualisation"><span class="header-section-number">1.2</span> Visualisation</h2>
<p><a href="https://matplotlib.org/stable/gallery/shapes_and_collections/scatter.html">matplotlib scatter plot</a></p>
<p><a href="https://matplotlib.org/stable/gallery/color/color_demo.html">Les couleurs sous matplotlib</a></p>
<div id="189c4876-9397-4c03-939e-7cc01950ef5c" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># points_bleus puis points_rouges</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>abscisses <span class="op">=</span> []</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>ordonnées <span class="op">=</span> []</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>couleurs <span class="op">=</span> []</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x,y <span class="kw">in</span> points_bleus:</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    abscisses.append(x)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ordonnées.append(y)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    couleurs.append(<span class="st">'tab:blue'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x,y <span class="kw">in</span> points_rouges:</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    abscisses.append(x)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    ordonnées.append(y)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    couleurs.append(<span class="st">'tab:red'</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>plt.scatter(abscisses, ordonnées, c<span class="op">=</span>couleurs, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="classification-dun-nouveau-point-pris-au-hasard" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="classification-dun-nouveau-point-pris-au-hasard"><span class="header-section-number">1.2.1</span> Classification d’un nouveau point pris au hasard</h3>
<p>exemple avec k = 3</p>
<div id="856ce2e9-d5fd-43ce-9d26-e9809092fdd6" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nouveau_point = (random.randint(0,100), random.randint(0,100))</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>nouveau_point <span class="op">=</span> (<span class="dv">11</span>, <span class="dv">48</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e448c894-4fbf-4876-b175-8a35a6375c27" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation du jeu de données et des points que l'on cherche à classer (ici représentés en vert)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>abscisses.append(<span class="dv">11</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ordonnées.append(<span class="dv">48</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>abscisses.append(<span class="dv">25</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>ordonnées.append(<span class="dv">26</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>couleurs.append(<span class="st">'black'</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>couleurs.append(<span class="st">'black'</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(abscisses, ordonnées, c<span class="op">=</span>couleurs, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="jeu-de-données-initial-et-étiquettes-associées" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="jeu-de-données-initial-et-étiquettes-associées"><span class="header-section-number">1.2.2</span> Jeu de données initial et étiquettes associées</h3>
<div id="35877062-16e1-4ebb-b58d-009d4f329921" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> points_bleus <span class="op">+</span> points_rouges</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>couleurs <span class="op">=</span> [<span class="st">'bleu'</span>]<span class="op">*</span><span class="dv">10</span> <span class="op">+</span> [<span class="st">'rouge'</span>]<span class="op">*</span><span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="23ae2fb5-c864-4ef6-bced-920bce074aaf" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>couleurs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>['bleu',
 'bleu',
 'bleu',
 'bleu',
 'bleu',
 'bleu',
 'bleu',
 'bleu',
 'bleu',
 'bleu',
 'rouge',
 'rouge',
 'rouge',
 'rouge',
 'rouge',
 'rouge',
 'rouge',
 'rouge',
 'rouge',
 'rouge']</code></pre>
</div>
</div>
</section>
<section id="etapes-de-lalgorithme" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="etapes-de-lalgorithme"><span class="header-section-number">1.2.3</span> Etapes de l’algorithme</h3>
<p>Distance entre deux points A et B du plan:</p>
<p><span class="math display">\[ L_2(A,B) = \sqrt{(x_A-x_B)^2+(y_A-y_B)^2}\]</span></p>
<p><a href="https://docs.python.org/3/library/math.html">python library math</a></p>
<pre><code>math.dist(p, q)

Return the Euclidean distance between two points p and q, each given as a sequence (or iterable) of coordinates. The two points must have the same dimension.</code></pre>
<div id="670aaf96-1318-4631-8dae-811a84b3d2f4" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>origine <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>unité <span class="op">=</span> (<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>math.dist(origine, unité)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>1.4142135623730951</code></pre>
</div>
</div>
<p>Calcul de l’ensemble des distances du nouveau point aux points du jeu de données initiales</p>
<div id="53319b26-0e45-4afe-898d-7bf2882668da" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> [math.dist(point, nouveau_point) <span class="cf">for</span> point <span class="kw">in</span> points]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3cfe0bb4-d087-4094-a46c-8a5ff0f4e50f" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># La ligne précédente est équivalente à :</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> []</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> point <span class="kw">in</span> points:</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    distances.append(math.dist(point, nouveau_point))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://realpython.com/list-comprehension-python/">realpython list comprehension</a></p>
<div id="5bdcbb87-87c7-403d-bce6-9e4bd3b648e8" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>distances</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>[46.69047011971501,
 87.98295289429652,
 21.0,
 24.08318915758459,
 53.33854141237835,
 22.47220505424423,
 45.39823785126467,
 51.07837115648854,
 4.0,
 22.02271554554524,
 77.82030583337487,
 29.410882339705484,
 35.35533905932738,
 90.07774419910837,
 68.79680225126747,
 64.28063471995279,
 45.5411901469428,
 79.88116173416608,
 64.25729530566937,
 87.32124598286491]</code></pre>
</div>
</div>
<div id="015aedf7-7cdf-456e-83f5-424417a41826" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste des distances associées aux couleurs de points</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>[(d, c) <span class="cf">for</span> (d,c) <span class="kw">in</span> <span class="bu">zip</span>(distances, couleurs)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>[(46.69047011971501, 'bleu'),
 (87.98295289429652, 'bleu'),
 (21.0, 'bleu'),
 (24.08318915758459, 'bleu'),
 (53.33854141237835, 'bleu'),
 (22.47220505424423, 'bleu'),
 (45.39823785126467, 'bleu'),
 (51.07837115648854, 'bleu'),
 (4.0, 'bleu'),
 (22.02271554554524, 'bleu'),
 (77.82030583337487, 'rouge'),
 (29.410882339705484, 'rouge'),
 (35.35533905932738, 'rouge'),
 (90.07774419910837, 'rouge'),
 (68.79680225126747, 'rouge'),
 (64.28063471995279, 'rouge'),
 (45.5411901469428, 'rouge'),
 (79.88116173416608, 'rouge'),
 (64.25729530566937, 'rouge'),
 (87.32124598286491, 'rouge')]</code></pre>
</div>
</div>
<div id="a04f0e27-f0cf-45c9-ae65-4f1f255b8799" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>distances_classées <span class="op">=</span> <span class="bu">sorted</span>([(d, c) <span class="cf">for</span> (d,c) <span class="kw">in</span> <span class="bu">zip</span>(distances, couleurs)])</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>distances_classées</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>[(4.0, 'bleu'),
 (21.0, 'bleu'),
 (22.02271554554524, 'bleu'),
 (22.47220505424423, 'bleu'),
 (24.08318915758459, 'bleu'),
 (29.410882339705484, 'rouge'),
 (35.35533905932738, 'rouge'),
 (45.39823785126467, 'bleu'),
 (45.5411901469428, 'rouge'),
 (46.69047011971501, 'bleu'),
 (51.07837115648854, 'bleu'),
 (53.33854141237835, 'bleu'),
 (64.25729530566937, 'rouge'),
 (64.28063471995279, 'rouge'),
 (68.79680225126747, 'rouge'),
 (77.82030583337487, 'rouge'),
 (79.88116173416608, 'rouge'),
 (87.32124598286491, 'rouge'),
 (87.98295289429652, 'bleu'),
 (90.07774419910837, 'rouge')]</code></pre>
</div>
</div>
<div id="97772c12-c3f1-4eeb-b4c1-64f8033678e5" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>k<span class="op">=</span><span class="dv">3</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>distances_classées[:k]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>[(4.0, 'bleu'), (21.0, 'bleu'), (22.02271554554524, 'bleu')]</code></pre>
</div>
</div>
<p>Cas d’une classification erronée (dûe au manque de points dans le jeu de données initial)</p>
<div id="56cc86c0-03b4-4ef1-bf2a-0de22a9b8ab5" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nouveau_point <span class="op">=</span> (<span class="dv">25</span>, <span class="dv">26</span>)  <span class="co"># devrait être classé en bleu</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>distances <span class="op">=</span> [math.dist(point, nouveau_point) <span class="cf">for</span> point <span class="kw">in</span> points]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>plus_petites_distances <span class="op">=</span> <span class="bu">sorted</span>([(d, c) <span class="cf">for</span> (d,c) <span class="kw">in</span> <span class="bu">zip</span>(distances, couleurs)])[:k]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>plus_petites_distances</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>[(6.082762530298219, 'bleu'),
 (9.486832980505138, 'rouge'),
 (11.180339887498949, 'rouge')]</code></pre>
</div>
</div>
<p>Extraction de la couleur la plus fréquente:</p>
<div id="e4b47109-2d4c-4123-b8d7-4f35d193d400" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>Counter([couleur <span class="cf">for</span> _, couleur <span class="kw">in</span> plus_petites_distances]).most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>'rouge'</code></pre>
</div>
</div>
</section>
</section>
<section id="fonction-knn" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="fonction-knn"><span class="header-section-number">1.3</span> Fonction kNN</h2>
<div id="ea0a7a9b-4651-40a0-bc84-1772961933a1" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kNN(X, y, new_x, k<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">    args:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">        X: jeu de données initiales</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">        y: classes associées aux éléments de X </span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">        new_x: nouveau point que l'on souhaite classer</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">        k: nombre de voisins pris dans l'évaluation</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    return:</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">        La classe de `y` la plus fréquente</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> [math.dist(new_x, x) <span class="cf">for</span> x <span class="kw">in</span> X]</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    plus_petites_distances <span class="op">=</span> <span class="bu">sorted</span>([(d, c) <span class="cf">for</span> (d,c) <span class="kw">in</span> <span class="bu">zip</span>(distances, y)])[:k]</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">=</span> Counter([classe <span class="cf">for</span> _, classe <span class="kw">in</span> plus_petites_distances])</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> counter.most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2cd0cc21-558c-469d-a32f-4fdead0abc64" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>kNN(points, couleurs, (<span class="dv">25</span>, <span class="dv">26</span>))  <span class="co"># devrait être classé en bleu</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>'rouge'</code></pre>
</div>
</div>
<div id="8808139e-effc-4bf4-a983-8a2b943dfa7e" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>kNN(points, couleurs, (<span class="dv">11</span>, <span class="dv">48</span>))  <span class="co"># devrait être classé en bleu</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>'bleu'</code></pre>
</div>
</div>
</section>
<section id="références" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="références"><span class="header-section-number">1.4</span> Références</h2>
<p><a href="https://www.youtube.com/watch?v=HVXime0nQeI">StatQuest: K-nearest neighbors, Clearly Explained</a></p>
</section>
</section>
<section id="normalisation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Normalisation</h1>
<section id="normalisation-motivation" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="normalisation-motivation"><span class="header-section-number">2.1</span> Normalisation: motivation</h2>
<p>Création d’un jeu de données d’exemple</p>
<div id="4c112081-4219-4cde-bef1-56e354cbfb3b" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> namedtuple</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>Point <span class="op">=</span> namedtuple(<span class="st">'Point'</span>, <span class="st">'x1 x2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f83da559-e9e9-4c38-829f-2ab54a0f5cb7" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> Point(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Point(x1=1, x2=2)</code></pre>
</div>
</div>
<div id="31b49db1-810b-4772-80d5-7937b3555323" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>p.x1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>1</code></pre>
</div>
</div>
<div id="a573dad1-c8d5-47db-92d1-47d3b4a2cf25" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>p[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>1</code></pre>
</div>
</div>
<div id="5da90add-cfe5-4cc2-b81f-34ec8525fee8" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># abscisses</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>[0, 2, 4, 6, 8, 10]</code></pre>
</div>
</div>
<div id="2b46ac35" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>points_bleus <span class="op">=</span> [Point(x1, <span class="dv">0</span>) <span class="cf">for</span> x1 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">12</span>,<span class="dv">2</span>)]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>points_rouges <span class="op">=</span> [Point(x1, <span class="dv">1</span>) <span class="cf">for</span> x1 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">2</span>)]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> points_bleus <span class="op">+</span> points_rouges</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>couleurs <span class="op">=</span> [<span class="st">'bleu'</span>]<span class="op">*</span><span class="bu">len</span>(points_bleus) <span class="op">+</span> [<span class="st">'rouge'</span>]<span class="op">*</span><span class="bu">len</span>(points_rouges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8e7867df-8dc2-42a5-a759-affd0fdb6a2e" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>[Point(x1=2, x2=0),
 Point(x1=4, x2=0),
 Point(x1=6, x2=0),
 Point(x1=8, x2=0),
 Point(x1=10, x2=0),
 Point(x1=0, x2=1),
 Point(x1=2, x2=1),
 Point(x1=4, x2=1),
 Point(x1=6, x2=1),
 Point(x1=8, x2=1)]</code></pre>
</div>
</div>
<div id="64c92c0c-31ad-48bf-a598-a3f8ad306da2" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>abscisses  <span class="op">=</span> [point.x1 <span class="cf">for</span> point <span class="kw">in</span> points]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>ordonnées <span class="op">=</span> [point.x2 <span class="cf">for</span> point <span class="kw">in</span> points]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>point_inconnu <span class="op">=</span> Point(<span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> []</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> couleurs:</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="op">==</span> <span class="st">'bleu'</span>:</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        colors.append(<span class="st">'tab:blue'</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>        colors.append(<span class="st">'tab:red'</span>)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co"># point_inconnu</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>abscisses.append(point_inconnu.x1)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>ordonnées.append(point_inconnu.x2)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>colors.append(<span class="st">'black'</span>)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">0.5</span>, <span class="dv">10</span>)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>plt.scatter(abscisses, ordonnées, c<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><code>(10, 1)</code> serait rouge mais classé bleu pour k=1</p>
<div id="027c7f79-09a2-4b8b-a99b-f38c25029e13" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>kNN(points, couleurs, point_inconnu, k<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>'bleu'</code></pre>
</div>
</div>
<div id="85853097-04d9-4643-a659-558c9e6b58ff" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>kNN(points, couleurs, point_inconnu, k<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>'bleu'</code></pre>
</div>
</div>
</section>
<section id="moyenne-variance-et-écart-type" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="moyenne-variance-et-écart-type"><span class="header-section-number">2.2</span> Moyenne, variance et écart type</h2>
<p>Pour l’ensemble de n valeurs <code>x = [x_1, ..., x_n ]</code>, on définit: - la moyenne (mean): <span class="math display">\[\overline{x} = \mu = \frac{1}{n} \sum_{i=1}^{n}x_{i}\]</span> - La variance qui est une mesure de la dispersion de l’échantillon, c’est la moyenne des carrés des distances à la moyenne de l’échantillon. <span class="math display">\[Var(x)=\sigma^2=\frac{1}{n} \sum_{i=1}^{n}(x_{i}-\mu)^2\]</span> - l’écart type (standard deviation) <span class="math display">\[\sigma=\sqrt{Var(x)}=\sqrt{\frac{1}{n} \sum_{i=1}^{n}(x_{i}-\overline{x})^2}\]</span></p>
</section>
<section id="normalisation-standard" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="normalisation-standard"><span class="header-section-number">2.3</span> Normalisation standard</h2>
<p>Pour l’ensemble de n valeurs <span class="math inline">\(x = [x_1, ..., x_n ]\)</span>, on définit: <span class="math display">\[z_{i} = \frac{x_{i}-\mu}{\sigma}\]</span></p>
<p>On utilise <code>z</code>à la place de <code>x</code></p>
<p>On fait le même procédé sur chacun des axes</p>
<div id="4729e1c2-ef08-40a4-89f3-3328d852d200" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>[Point(x1=2, x2=0),
 Point(x1=4, x2=0),
 Point(x1=6, x2=0),
 Point(x1=8, x2=0),
 Point(x1=10, x2=0),
 Point(x1=0, x2=1),
 Point(x1=2, x2=1),
 Point(x1=4, x2=1),
 Point(x1=6, x2=1),
 Point(x1=8, x2=1)]</code></pre>
</div>
</div>
<div id="604cab68-33a9-4e73-9114-f16bd13b8eaf" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>couleurs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>['bleu',
 'bleu',
 'bleu',
 'bleu',
 'bleu',
 'rouge',
 'rouge',
 'rouge',
 'rouge',
 'rouge']</code></pre>
</div>
</div>
<div id="9019cc55-e002-4691-9580-90b6324ae274" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> [point.x1 <span class="cf">for</span> point <span class="kw">in</span> points]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>x1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>[2, 4, 6, 8, 10, 0, 2, 4, 6, 8]</code></pre>
</div>
</div>
<p><a href="https://docs.python.org/3/library/statistics.html">statistics — Mathematical statistics functions</a></p>
<div id="e4d24c62-bd40-4c87-b664-e4a109cc47f9" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statistics <span class="im">import</span> mean, stdev, pstdev</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Moyenne</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>mean(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>5</code></pre>
</div>
</div>
<div id="35c6df54-434d-47f6-9331-7048ffadc679" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecart type</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>pstdev(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>3.0</code></pre>
</div>
</div>
<p>Remarque: <code>stdev</code> sert à évaluer l’écart type d’une population à partir d’un échantillon, ne donne pas le même résultat que la formule proposée qui, comme <code>pstdev</code>donne directement l’écart type d’une population.</p>
<div id="b8574d4b-2f79-4424-87db-58a219d66fa2" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>stdev(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>3.1622776601683795</code></pre>
</div>
</div>
<div id="4264e681-8ecf-4e57-9876-23bdab8466be" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>math.sqrt((<span class="dv">1</span><span class="op">/</span><span class="bu">len</span>(x1))<span class="op">*</span><span class="bu">sum</span>([(x1_i <span class="op">-</span> mean(x1))<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> x1_i <span class="kw">in</span> x1]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>3.0</code></pre>
</div>
</div>
<div id="5127bead-e126-4688-848c-d99fc2ead8b5" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>z1 <span class="op">=</span> [(x1_i <span class="op">-</span> mean(x1))<span class="op">/</span>pstdev(x1) <span class="cf">for</span> x1_i <span class="kw">in</span> x1]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>z1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>[-1.0,
 -0.3333333333333333,
 0.3333333333333333,
 1.0,
 1.6666666666666667,
 -1.6666666666666667,
 -1.0,
 -0.3333333333333333,
 0.3333333333333333,
 1.0]</code></pre>
</div>
</div>
<div id="04fbdd18-4b8e-4f30-b2dc-8ea36fdb38db" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>mean(z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>0.0</code></pre>
</div>
</div>
<div id="746ca187-06de-4389-848c-2dedc506b074" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pstdev(z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>1.0</code></pre>
</div>
</div>
<div id="f465914f-9a4a-480a-aed9-2ecca5451e26" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> [point.x2 <span class="cf">for</span> point <span class="kw">in</span> points]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>z2 <span class="op">=</span> [(x2_i <span class="op">-</span> mean(x2))<span class="op">/</span>pstdev(x2) <span class="cf">for</span> x2_i <span class="kw">in</span> x2]</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>z2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>[-1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0]</code></pre>
</div>
</div>
<div id="c6878f57-193c-47aa-a54b-ed846b4c78f6" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mean(z2), pstdev(z2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>(0.0, 1.0)</code></pre>
</div>
</div>
<div id="73c32249-2e6f-483d-a4a7-21ced9012e03" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>point_inconnu</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>Point(x1=10, x2=1)</code></pre>
</div>
</div>
<p>Les valeurs de moyennes et d’écarts types sont reprises pour la modification des coordonnées du point inconnu.</p>
<div id="8fa44fe7-9c8f-4732-9b68-4e697f88c86f" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>z1_inconnu <span class="op">=</span> (point_inconnu.x1 <span class="op">-</span> mean(x1))<span class="op">/</span>pstdev(x1)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>z2_inconnu <span class="op">=</span> (point_inconnu.x2 <span class="op">-</span> mean(x2))<span class="op">/</span>pstdev(x2)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour l'affichage</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>z1.append(z1_inconnu)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>z2.append(z2_inconnu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="930f8b63-0f67-468c-a84d-9575c1ad8a0c" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> []</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> couleurs:</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c <span class="op">==</span> <span class="st">'bleu'</span>:</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>        colors.append(<span class="st">'tab:blue'</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>        colors.append(<span class="st">'tab:red'</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>colors.append(<span class="st">'black'</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">1.6</span>, <span class="fl">1.6</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(z1, z2, c<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="knn-sur-données-normalisées" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="knn-sur-données-normalisées"><span class="header-section-number">2.4</span> kNN sur données normalisées</h2>
<div id="102c3276-6cf8-456f-9065-5bb078c8ede8" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>z1.pop()</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>z2.pop()</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">zip</span>(z1, z2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>[(-1.0, -1.0),
 (-0.3333333333333333, -1.0),
 (0.3333333333333333, -1.0),
 (1.0, -1.0),
 (1.6666666666666667, -1.0),
 (-1.6666666666666667, 1.0),
 (-1.0, 1.0),
 (-0.3333333333333333, 1.0),
 (0.3333333333333333, 1.0),
 (1.0, 1.0)]</code></pre>
</div>
</div>
<div id="24295dfa-7eed-4ad8-8fbd-e59ae827d41e" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>X_normalisé <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(z1, z2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="257f5c0d-02fa-4e1c-bcaf-1f8321c51820" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>point_inconnu_normalisé <span class="op">=</span> Point(z1_inconnu, z2_inconnu)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>point_inconnu_normalisé</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>Point(x1=1.6666666666666667, x2=1.0)</code></pre>
</div>
</div>
<div id="e2e4923a-e9d2-4f7b-9f91-654bfd852069" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>kNN(X_normalisé, couleurs, point_inconnu_normalisé, k<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>'rouge'</code></pre>
</div>
</div>
<div id="26c52bd7-c162-4e60-9d95-853d10881c34" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>kNN(X_normalisé, couleurs, point_inconnu_normalisé, k<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>'rouge'</code></pre>
</div>
</div>
<div id="814d4a90-c941-4c08-8906-2179059dac21" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>kNN(X_normalisé, couleurs, point_inconnu_normalisé, k<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>'rouge'</code></pre>
</div>
</div>
</section>
</section>
<section id="parallèle-avec-scikit-learn" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Parallèle avec scikit learn</h1>
<p>Nous allons coder deux classes au fonctionnement similaire à celles de scikit learn: StandardScaler pour la normalisation et NearestNeighbors pour le knn.</p>
<blockquote class="blockquote">
<p>Ne pas utiliser <code>sklearn</code> pour l’instant.</p>
</blockquote>
<section id="nomenclature" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="nomenclature"><span class="header-section-number">3.1</span> Nomenclature</h2>
<div id="7a38a088-2042-4f54-b245-40d35ef8dc6f" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> namedtuple</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>Point <span class="op">=</span> namedtuple(<span class="st">'Point'</span>, <span class="st">'x_1 x_2'</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>points_bleus <span class="op">=</span> [Point(x_1, <span class="dv">0</span>) <span class="cf">for</span> x_1 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">12</span>,<span class="dv">2</span>)]</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>points_rouges <span class="op">=</span> [Point(x_1, <span class="dv">1</span>) <span class="cf">for</span> x_1 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">2</span>)]</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> points_bleus <span class="op">+</span> points_rouges</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>couleurs <span class="op">=</span> [<span class="st">'bleu'</span>]<span class="op">*</span><span class="bu">len</span>(points_bleus) <span class="op">+</span> [<span class="st">'rouge'</span>]<span class="op">*</span><span class="bu">len</span>(points_rouges)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'abscisse'</span> : [point.x_1 <span class="cf">for</span> point <span class="kw">in</span> points],</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'ordonnée'</span> : [point.x_2 <span class="cf">for</span> point <span class="kw">in</span> points],</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'couleur'</span> : couleurs})</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>data</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a><span class="co"># observation // individu</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a><span class="co"># X : caractéristiques (features), ici [abscisse, ordonnée], [x_1, x_2]</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a><span class="co"># y : classe, cible ici couleur</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">abscisse</th>
<th data-quarto-table-cell-role="th">ordonnée</th>
<th data-quarto-table-cell-role="th">couleur</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>0</td>
<td>bleu</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4</td>
<td>0</td>
<td>bleu</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>0</td>
<td>bleu</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8</td>
<td>0</td>
<td>bleu</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>0</td>
<td>bleu</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0</td>
<td>1</td>
<td>rouge</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>1</td>
<td>rouge</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>4</td>
<td>1</td>
<td>rouge</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>6</td>
<td>1</td>
<td>rouge</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>8</td>
<td>1</td>
<td>rouge</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Scikit-learn travaille avec des valeurs numériques (Notre algorithme quant à lui autorise des valeurs textuelles pour <code>y</code>)</p>
<div id="529f5ca0-4db7-4073-96e8-2ffe4fa6eee6" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>[c<span class="op">==</span><span class="st">'bleu'</span> <span class="cf">for</span> c <span class="kw">in</span> couleurs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>[True, True, True, True, True, False, False, False, False, False]</code></pre>
</div>
</div>
<div id="71e31896-19d7-454b-8dc0-b4cb40897719" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'x_1'</span> : [point.x_1 <span class="cf">for</span> point <span class="kw">in</span> points],</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'x_2'</span> : [point.x_2 <span class="cf">for</span> point <span class="kw">in</span> points],</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'y'</span> : [<span class="bu">int</span>(c<span class="op">==</span><span class="st">'bleu'</span>) <span class="cf">for</span> c <span class="kw">in</span> couleurs]})</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x_1</th>
<th data-quarto-table-cell-role="th">x_2</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>6</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>4</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>6</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>8</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="8cc1d8f9-7243-4028-a63c-73633f502131" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame({<span class="st">'x_1'</span> : [point.x_1 <span class="cf">for</span> point <span class="kw">in</span> points],</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'x_2'</span> : [point.x_2 <span class="cf">for</span> point <span class="kw">in</span> points]})</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> x_1  x_2
   2    0
   4    0
   6    0
   8    0
  10    0
   0    1
   2    1
   4    1
   6    1
   8    1</code></pre>
</div>
</div>
<p><span class="math display">\[
X=
\begin{bmatrix}
2 &amp; 0\\
4 &amp; 0\\
6 &amp; 0\\
\vdots &amp; \vdots \\
8 &amp; 1\\
\end{bmatrix}
\]</span></p>
<div id="789bd5ef-527f-4bb2-96a2-ef139fa4069a" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># y</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pd.DataFrame({<span class="st">'y'</span> : [<span class="bu">int</span>(c<span class="op">==</span><span class="st">'bleu'</span>) <span class="cf">for</span> c <span class="kw">in</span> couleurs]})</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> y
 1
 1
 1
 1
 1
 0
 0
 0
 0
 0</code></pre>
</div>
</div>
<p><span class="math display">\[
y=
\begin{bmatrix}
1\\
1\\
1\\
\vdots \\
0\\
\end{bmatrix}
\]</span></p>
</section>
<section id="standardisation" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="standardisation"><span class="header-section-number">3.2</span> Standardisation</h2>
<p>Ne pas utiliser <code>sklearn</code> pour l’instant. Par contre, on va s’inspirer de la signature des fonctions de <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html">sklearn.preprocessing.StandardScaler</a></p>
<div id="aee00337-f8f0-45c4-931b-cdf04af3dc20" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Scaler():</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X):</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Compute the mean and std to be used for later scaling."""</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Perform standardization by centering and scaling."""</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7719f716-566b-4b9f-a016-13884cf7e0ac" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>[Point(x_1=2, x_2=0),
 Point(x_1=4, x_2=0),
 Point(x_1=6, x_2=0),
 Point(x_1=8, x_2=0),
 Point(x_1=10, x_2=0),
 Point(x_1=0, x_2=1),
 Point(x_1=2, x_2=1),
 Point(x_1=4, x_2=1),
 Point(x_1=6, x_2=1),
 Point(x_1=8, x_2=1)]</code></pre>
</div>
</div>
<div id="61e504fc-7195-484f-b7fc-e3dac4a8e71c" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array(points, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>array([[ 2.,  0.],
       [ 4.,  0.],
       [ 6.,  0.],
       [ 8.,  0.],
       [10.,  0.],
       [ 0.,  1.],
       [ 2.,  1.],
       [ 4.,  1.],
       [ 6.,  1.],
       [ 8.,  1.]])</code></pre>
</div>
</div>
<div id="f910d720-34a8-4a06-a3d8-07f233bbdb6e" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>X.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>(10, 2)</code></pre>
</div>
</div>
<div id="76e09b3b-187e-4ff5-8e43-7c35777fcadc" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Vecteur colonne </span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(np.atleast_2d(X[:, j]).T)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Vecteur colonne 0
[[ 2.]
 [ 4.]
 [ 6.]
 [ 8.]
 [10.]
 [ 0.]
 [ 2.]
 [ 4.]
 [ 6.]
 [ 8.]]


Vecteur colonne 1
[[0.]
 [0.]
 [0.]
 [0.]
 [0.]
 [1.]
 [1.]
 [1.]
 [1.]
 [1.]]

</code></pre>
</div>
</div>
<div id="41d37e70-43cc-48e2-9711-6ab83e139610" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statistics <span class="im">import</span> mean, stdev</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>_mean <span class="op">=</span> []</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>_stdev <span class="op">=</span> []</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    _mean.append(mean(X[:, j]))</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    _stdev.append(stdev(X[:, j]))</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>_mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>[5.0, 0.5]</code></pre>
</div>
</div>
<div id="ed3b0f10-b6f5-4112-a018-52162cec30c6" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>_stdev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>[3.1622776601683795, 0.5270462766947299]</code></pre>
</div>
</div>
<p>Remarque: stdev plutôt que pstdev, car on peu considérer que l’on évalue l’écart type d’une population bien plus grande. En fait, ici les deux sont équivalents.</p>
<div id="635b0e6a-5293-41cf-a290-4e9147d492ba" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>X_normalisé <span class="op">=</span> np.zeros_like(X)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>X_normalisé</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>array([[0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.],
       [0., 0.]])</code></pre>
</div>
</div>
<div id="56260f1e-0907-4bde-af83-bcde4acae3ac" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>    X_normalisé[:, j] <span class="op">=</span> (X[:, j] <span class="op">-</span> _mean[j])<span class="op">/</span>_stdev[j]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="46b3f753-44e9-4b34-8fee-513bcef3220e" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>X_normalisé</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>array([[-0.9486833 , -0.9486833 ],
       [-0.31622777, -0.9486833 ],
       [ 0.31622777, -0.9486833 ],
       [ 0.9486833 , -0.9486833 ],
       [ 1.58113883, -0.9486833 ],
       [-1.58113883,  0.9486833 ],
       [-0.9486833 ,  0.9486833 ],
       [-0.31622777,  0.9486833 ],
       [ 0.31622777,  0.9486833 ],
       [ 0.9486833 ,  0.9486833 ]])</code></pre>
</div>
</div>
<div id="ef3eb392-eaee-458d-b696-40404c21e82a" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Scaler():</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._mean <span class="op">=</span> []</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._stdev <span class="op">=</span> []</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X):</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Compute the mean and std to be used for later scaling."""</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> np.array(X, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._mean.clear()</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._stdev.clear()</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> axe <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._mean.append(mean(X[:, axe]))</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._stdev.append(stdev(X[:, axe]))</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Perform standardization by centering and scaling."""</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> np.array(X, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>        X_normalisé <span class="op">=</span> np.zeros_like(X)        </span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>            X_normalisé[:, j] <span class="op">=</span> (X[:, j] <span class="op">-</span> <span class="va">self</span>._mean[j])<span class="op">/</span><span class="va">self</span>._stdev[j]</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X_normalisé</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="218ebf0d-3daf-43a9-8526-2fd9847d22fd" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> Scaler()</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>scaler.fit(points)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>points_normalisés <span class="op">=</span> scaler.transform(points)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>points_normalisés</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>array([[-0.9486833 , -0.9486833 ],
       [-0.31622777, -0.9486833 ],
       [ 0.31622777, -0.9486833 ],
       [ 0.9486833 , -0.9486833 ],
       [ 1.58113883, -0.9486833 ],
       [-1.58113883,  0.9486833 ],
       [-0.9486833 ,  0.9486833 ],
       [-0.31622777,  0.9486833 ],
       [ 0.31622777,  0.9486833 ],
       [ 0.9486833 ,  0.9486833 ]])</code></pre>
</div>
</div>
<div id="c830ad0e-8fdf-4895-bfd0-a35eab5fa3ff" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>point_inconnu <span class="op">=</span> Point(<span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>scaler.transform([point_inconnu])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>array([[1.58113883, 0.9486833 ]])</code></pre>
</div>
</div>
<div id="f90ef040-249e-4205-9697-bcd189ed7810" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exemple avec X qui a plus de caractéristiques (i.e. colonnes):</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6a5143e7-fc10-4308-b21e-ab936591e88f" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.random.rand(<span class="dv">4</span>,<span class="dv">5</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>array([[83.09934843, 70.7708862 , 25.3335158 , 48.63451057, 36.18838536],
       [22.55555815, 26.97835092, 60.7139201 , 68.64884267,  0.52602388],
       [86.4091598 , 55.41345421, 57.79210772, 88.2442086 , 87.02527141],
       [80.57458884, 55.85006234, 57.21028627, 46.14293692, 78.31167989]])</code></pre>
</div>
</div>
<div id="3d216e22-dac9-4f39-8d53-6f00a6d62b33" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> Scaler()</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>scaler.fit(X)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>scaler.transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>array([[ 0.48988251,  1.01190747, -1.49365893, -0.72646452, -0.35774617],
       [-1.49538991, -1.38115425,  0.62621673,  0.29149991, -1.24839601],
       [ 0.59841349,  0.17269407,  0.45115149,  1.28815499,  0.91187991],
       [ 0.40709391,  0.19655271,  0.4162907 , -0.85319038,  0.69426227]])</code></pre>
</div>
</div>
<div id="131618e3-7cce-4de6-8882-756b67e6d46a" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>mean(scaler.transform(X)[:,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>-6.938893903907228e-17</code></pre>
</div>
</div>
</section>
<section id="classification" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="classification"><span class="header-section-number">3.3</span> Classification</h2>
<p>Ne pas utiliser <code>sklearn</code> pour l’instant. Par contre, on va s’inspirer de la signature des fonctions de <a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KNeighborsClassifier.html#sklearn.neighbors.KNeighborsClassifier">sklearn.neighbors.KNeighborsClassifier</a>.</p>
<div id="20a7608a-96a1-4047-b2a4-f76f3f2aaccd" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> knnClassifier():</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, k<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Fit the nearest neighbors estimator from the training dataset."""</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X):</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Predict the class labels for the provided data."""</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="78d85588-b919-49ec-9d3e-1f940ddd91bf" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> knnClassifier():</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, k<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.k <span class="op">=</span> k</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_X <span class="op">=</span> <span class="va">None</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_y <span class="op">=</span> <span class="va">None</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Fit the nearest neighbors estimator from the training dataset."""</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_X <span class="op">=</span> np.array(X, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_y <span class="op">=</span> y</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X):</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Predict the class labels for the provided data."""</span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> kNN(new_x):</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">"""</span></span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a><span class="co">            args:</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a><span class="co">                X: jeu de données initiales</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a><span class="co">                y: classes associées aux éléments de X </span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a><span class="co">                new_x: nouveau point que l'on souhaite classer</span></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a><span class="co">                k: nombre de voisins pris dans l'évaluation</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a><span class="co">            return:</span></span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a><span class="co">                La classe de `y` la plus fréquente</span></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a><span class="co">            """</span></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a>            distances <span class="op">=</span> [math.dist(new_x, x) <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>._fit_X]</span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a>            plus_petites_distances <span class="op">=</span> <span class="bu">sorted</span>([(d, c) <span class="cf">for</span> (d,c) <span class="kw">in</span> <span class="op">\</span></span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a>                                             <span class="bu">zip</span>(distances, <span class="va">self</span>._fit_y)])[:<span class="va">self</span>.k]</span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a>            counter <span class="op">=</span> Counter([classe <span class="cf">for</span> _, classe <span class="kw">in</span> plus_petites_distances])</span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> counter.most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [kNN(x) <span class="cf">for</span> x <span class="kw">in</span> X]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c9abcc36-1ff6-4719-8a49-ff492293fa6b" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>points_inconnus <span class="op">=</span> [Point(<span class="dv">0</span>, <span class="dv">0</span>), Point(<span class="dv">10</span>, <span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1344a15d-11aa-4079-a69c-fd37528e197d" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans normalisation</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> knnClassifier()</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>classifier.fit(points, couleurs)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>classifier.predict(points_inconnus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>['rouge', 'bleu']</code></pre>
</div>
</div>
<div id="d0aa4e17-dc11-4e8a-ab64-7987b895ad0e" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Avec normalisation</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> Scaler()</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>scaler.fit(points)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>points_normalisés <span class="op">=</span> scaler.transform(points)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>points_inconnus_normalisés <span class="op">=</span> scaler.transform(points_inconnus)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> knnClassifier()</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>classifier.fit(points_normalisés, couleurs)</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>classifier.predict(points_inconnus_normalisés)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>['bleu', 'rouge']</code></pre>
</div>
</div>
</section>
</section>
<section id="application-à-un-vrai-jeu-de-données" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Application à un vrai jeu de données</h1>
<p>Peut-on prédire si un client va acheter une assurance ou pas?</p>
<p><a href="https://islp.readthedocs.io/en/latest/datasets/Caravan.html">dataset Caravan</a></p>
<p><a href="https://islp.readthedocs.io/en/latest/installation.html">instructions d’installations</a></p>
<p>Les données contiennent 5 822 enregistrements de clients réels. Chaque enregistrement se compose de 86 variables, contenant des données sociodémographiques (variables 1 à 43) et la souscription ou la possession de certains produits (variables 44 à 86). Les données sociodémographiques sont dérivées des codes postaux. Tous les clients vivant dans des zones ayant le même code postal ont les mêmes attributs sociodémographiques. La variable 86 (Achat) indique si le client a souscrit une police d’assurance caravane. De plus amples informations sur les variables individuelles peuvent être obtenues sur <a href="http://www.liacs.nl/~putten/library/cc2000/data.html">http://www.liacs.nl/~putten/library/cc2000/data.html</a></p>
<section id="séparation-du-jeu-de-données-en-données-dentraînement-et-données-de-test" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="séparation-du-jeu-de-données-en-données-dentraînement-et-données-de-test"><span class="header-section-number">4.1</span> Séparation du jeu de données en données d’entraînement et données de test</h2>
<div id="94fcb78a" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>caravan <span class="op">=</span> load_data(<span class="st">'Caravan'</span>)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>caravan.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>Index(['MOSTYPE', 'MAANTHUI', 'MGEMOMV', 'MGEMLEEF', 'MOSHOOFD', 'MGODRK',
       'MGODPR', 'MGODOV', 'MGODGE', 'MRELGE', 'MRELSA', 'MRELOV', 'MFALLEEN',
       'MFGEKIND', 'MFWEKIND', 'MOPLHOOG', 'MOPLMIDD', 'MOPLLAAG', 'MBERHOOG',
       'MBERZELF', 'MBERBOER', 'MBERMIDD', 'MBERARBG', 'MBERARBO', 'MSKA',
       'MSKB1', 'MSKB2', 'MSKC', 'MSKD', 'MHHUUR', 'MHKOOP', 'MAUT1', 'MAUT2',
       'MAUT0', 'MZFONDS', 'MZPART', 'MINKM30', 'MINK3045', 'MINK4575',
       'MINK7512', 'MINK123M', 'MINKGEM', 'MKOOPKLA', 'PWAPART', 'PWABEDR',
       'PWALAND', 'PPERSAUT', 'PBESAUT', 'PMOTSCO', 'PVRAAUT', 'PAANHANG',
       'PTRACTOR', 'PWERKT', 'PBROM', 'PLEVEN', 'PPERSONG', 'PGEZONG',
       'PWAOREG', 'PBRAND', 'PZEILPL', 'PPLEZIER', 'PFIETS', 'PINBOED',
       'PBYSTAND', 'AWAPART', 'AWABEDR', 'AWALAND', 'APERSAUT', 'ABESAUT',
       'AMOTSCO', 'AVRAAUT', 'AAANHANG', 'ATRACTOR', 'AWERKT', 'ABROM',
       'ALEVEN', 'APERSONG', 'AGEZONG', 'AWAOREG', 'ABRAND', 'AZEILPL',
       'APLEZIER', 'AFIETS', 'AINBOED', 'ABYSTAND', 'Purchase'],
      dtype='object')</code></pre>
</div>
</div>
<div id="7b9b3b63" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>caravan.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>(5822, 86)</code></pre>
</div>
</div>
<p>Séparation du jeu de données en données d’entraînement (80%) et données de test (20%) sans <code>sklearn</code></p>
<div id="3c8d5bc8" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>caravan.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MOSTYPE</th>
<th data-quarto-table-cell-role="th">MAANTHUI</th>
<th data-quarto-table-cell-role="th">MGEMOMV</th>
<th data-quarto-table-cell-role="th">MGEMLEEF</th>
<th data-quarto-table-cell-role="th">MOSHOOFD</th>
<th data-quarto-table-cell-role="th">MGODRK</th>
<th data-quarto-table-cell-role="th">MGODPR</th>
<th data-quarto-table-cell-role="th">MGODOV</th>
<th data-quarto-table-cell-role="th">MGODGE</th>
<th data-quarto-table-cell-role="th">MRELGE</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">APERSONG</th>
<th data-quarto-table-cell-role="th">AGEZONG</th>
<th data-quarto-table-cell-role="th">AWAOREG</th>
<th data-quarto-table-cell-role="th">ABRAND</th>
<th data-quarto-table-cell-role="th">AZEILPL</th>
<th data-quarto-table-cell-role="th">APLEZIER</th>
<th data-quarto-table-cell-role="th">AFIETS</th>
<th data-quarto-table-cell-role="th">AINBOED</th>
<th data-quarto-table-cell-role="th">ABYSTAND</th>
<th data-quarto-table-cell-role="th">Purchase</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>33</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>8</td>
<td>0</td>
<td>5</td>
<td>1</td>
<td>3</td>
<td>7</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>37</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>8</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>4</td>
<td>6</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>37</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>8</td>
<td>0</td>
<td>4</td>
<td>2</td>
<td>4</td>
<td>3</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>9</td>
<td>1</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>40</td>
<td>1</td>
<td>4</td>
<td>2</td>
<td>10</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>4</td>
<td>7</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
</tr>
</tbody>
</table>

<p>5 rows × 86 columns</p>
</div>
</div>
</div>
<div id="61c3f169" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>caravan.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>MOSTYPE      int64
MAANTHUI     int64
MGEMOMV      int64
MGEMLEEF     int64
MOSHOOFD     int64
             ...  
APLEZIER     int64
AFIETS       int64
AINBOED      int64
ABYSTAND     int64
Purchase    object
Length: 86, dtype: object</code></pre>
</div>
</div>
<div id="59b7edd8-713b-4acf-a001-ff775887143c" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>caravan.Purchase.<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x<span class="op">==</span><span class="st">'Yes'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>0       0
1       0
2       0
3       0
4       0
       ..
5817    0
5818    0
5819    1
5820    0
5821    0
Name: Purchase, Length: 5822, dtype: int64</code></pre>
</div>
</div>
<div id="645684af-af76-4697-b130-08899c3f2e81" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>caravan.Purchase <span class="op">=</span> caravan.Purchase.<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x<span class="op">==</span><span class="st">'Yes'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a7b7b97c-5fb1-4954-84dc-75d77d233ac6" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>caravan.to_numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>array([[33,  1,  3, ...,  0,  0,  0],
       [37,  1,  2, ...,  0,  0,  0],
       [37,  1,  2, ...,  0,  0,  0],
       ...,
       [33,  1,  3, ...,  0,  0,  1],
       [34,  1,  3, ...,  0,  0,  0],
       [33,  1,  3, ...,  0,  0,  0]])</code></pre>
</div>
</div>
<div id="4f38a054-b50e-4a1c-9a2a-d0059483ce54" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> caravan.to_numpy()[:,:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>X.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>(5822, 85)</code></pre>
</div>
</div>
<div id="aff4d6ea-3ed5-4f14-ab8b-eb8e2941927d" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> caravan.to_numpy()[:,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>y.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>(5822,)</code></pre>
</div>
</div>
<div id="ca965c5a-2145-4b57-9d5c-3c1c6c036875" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>array([[33,  1,  3, ...,  0,  0,  0],
       [37,  1,  2, ...,  0,  0,  0],
       [37,  1,  2, ...,  0,  0,  0],
       ...,
       [33,  1,  3, ...,  0,  0,  0],
       [34,  1,  3, ...,  0,  0,  0],
       [33,  1,  3, ...,  0,  0,  0]])</code></pre>
</div>
</div>
<div id="9a1dcb11-abff-4989-bf17-cf501dc214b3" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>array([0, 0, 0, ..., 1, 0, 0])</code></pre>
</div>
</div>
<div id="7d642d64-e3a3-4bf4-b0a1-e1208669b653" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sans utilisation de numpy X_, y_</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>X_ <span class="op">=</span> X.tolist()</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(X_), <span class="bu">len</span>(X_), <span class="bu">len</span>(X_[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="95">
<pre><code>(list, 5822, 85)</code></pre>
</div>
</div>
<div id="79a4c49c-6bea-40df-88fe-3acec3aa7b95" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>y_ <span class="op">=</span> y.tolist()</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(y_), <span class="bu">len</span>(y_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>(list, 5822)</code></pre>
</div>
</div>
<section id="solution-avec-random.shufflex" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="solution-avec-random.shufflex"><span class="header-section-number">4.1.1</span> Solution avec random.shuffle(x)</h3>
<p>Solution avec <a href="https://docs.python.org/3/library/random.html">random.shuffle(x)</a></p>
<div id="ff90630d-772c-45fc-9c6d-1a3f4b06c691" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">10</span>))</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
</div>
</div>
<div id="95fc4b97-a1b1-4909-b7eb-2669d303a6c6" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="22896afa-dee7-4f94-9c53-4040701dd041" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>random.shuffle(indices)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>[2, 9, 7, 1, 6, 0, 8, 3, 5, 4]</code></pre>
</div>
</div>
<div id="9d1ad01c-71f0-41d0-8a4a-e6d68e82cedd" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>séparateur <span class="op">=</span> math.floor(<span class="bu">len</span>(indices)<span class="op">*</span><span class="dv">20</span><span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>séparateur</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>2</code></pre>
</div>
</div>
<div id="f9da41ea-ec0d-4c55-897e-2d4a81f6689d" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>indices[:séparateur]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>[2, 9]</code></pre>
</div>
</div>
<div id="b1a9397e-25d5-4f9f-bf2a-b8e66701057d" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>indices[séparateur:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>[7, 1, 6, 0, 8, 3, 5, 4]</code></pre>
</div>
</div>
</section>
<section id="solution-avec-random.sample" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="solution-avec-random.sample"><span class="header-section-number">4.1.2</span> Solution avec random.sample()</h3>
<p>Solution avec <a href="https://docs.python.org/3/library/random.html">random.sample()</a></p>
<div id="aa664747-f958-48f0-ac99-6b5e13cfa992" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1a954056-230f-4aad-9ec5-6579e6ba192f" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
</div>
</div>
<div id="f487e821-a2f6-4b1d-b429-8e291d756f5f" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>random.sample(<span class="bu">range</span>(<span class="dv">10</span>), k<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<pre><code>[6, 9, 0]</code></pre>
</div>
</div>
<div id="616a961a-0c93-448f-a2e8-8338d344b3b5" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>nombre_de_ligne <span class="op">=</span> X.shape[<span class="dv">0</span>]</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">3141592</span>)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 20%</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>taille_de_l_échantillon <span class="op">=</span> math.floor(nombre_de_ligne<span class="op">*</span><span class="dv">20</span><span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>échantillon <span class="op">=</span> random.sample(<span class="bu">range</span>(nombre_de_ligne),</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>                            k<span class="op">=</span>taille_de_l_échantillon)</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(échantillon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>1164</code></pre>
</div>
</div>
<div id="42ea9eb9-46c7-4c21-b6be-f6e6a3f72332" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(<span class="bu">set</span>(échantillon))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>1164</code></pre>
</div>
</div>
<div id="0672a883-7e38-4a69-b0ff-76cc1d0aaac0" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X[échantillon, :]</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>(1164, 85)</code></pre>
</div>
</div>
<div id="ddb3fe06-5ddc-4563-96ed-b9447e971b67" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> y[échantillon]</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>y_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>(1164,)</code></pre>
</div>
</div>
<div id="da084899-7fcf-4786-a49a-24950066f55c" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemple pour récupérer les indices restants</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>échantillon_test <span class="op">=</span> random.sample(<span class="bu">range</span>(<span class="dv">10</span>), k<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(échantillon_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>{1, 7, 8}</code></pre>
</div>
</div>
<div id="83365cbb-05db-4fde-ad05-3e19536fed26" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> <span class="bu">set</span>(<span class="bu">range</span>(<span class="dv">10</span>))</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}</code></pre>
</div>
</div>
<div id="f0bf3f87-326b-4f67-8495-2c4cccc65d57" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>indices.difference_update(échantillon_test)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>{0, 2, 3, 4, 5, 6, 9}</code></pre>
</div>
</div>
<div id="839d3408-e088-48a5-8cc4-ee1715af7393" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour notre jeu de données</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>indices_restants <span class="op">=</span> <span class="bu">set</span>(<span class="bu">range</span>(nombre_de_ligne))</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>indices_restants.difference_update(échantillon)</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>indices_restants <span class="op">=</span> <span class="bu">list</span>(indices_restants)</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(indices_restants)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>4658</code></pre>
</div>
</div>
<div id="cd4d5676-6045-445f-b23f-023093f73e50" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X[indices_restants, :]</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>X_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>(4658, 85)</code></pre>
</div>
</div>
<div id="a57f9b4a-892a-4f2f-b20a-f733f4a129c2" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> y[indices_restants]</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>y_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>(4658,)</code></pre>
</div>
</div>
<p>Vérifier que la distribution des valeurs dans <code>y_train</code> et <code>y_test</code> corresponde à celle de <code>y</code>. Est-on sûr que ce soit le cas à chaque fois?</p>
<div id="f40c7816-7abd-44fd-9be1-cdbc3906b8d2" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>y_train.<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>0.05775010734220696</code></pre>
</div>
</div>
<div id="83a27611-d4d6-4191-aace-024aa2ce06c2" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>y_test.<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>0.06786941580756013</code></pre>
</div>
</div>
</section>
</section>
<section id="notre-implémentation-des-algorithmes" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="notre-implémentation-des-algorithmes"><span class="header-section-number">4.2</span> Notre implémentation des algorithmes</h2>
<p>Test de nos objets sur ce jeu de données (si la généralisation à un nombre arbitraire de colonnes a été faite)</p>
<div id="67f1a057-149b-4c14-9985-554752232c95" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statistics <span class="im">import</span> mean, stdev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a7b646be-9b81-442b-838a-35c3c90257f4" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Scaler():</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._mean <span class="op">=</span> []</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._stdev <span class="op">=</span> []</span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X):</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Compute the mean and std to be used for later scaling."""</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> np.array(X, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._mean.clear()</span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._stdev.clear()</span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> axe <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._mean.append(mean(X[:, axe]))</span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._stdev.append(stdev(X[:, axe]))</span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, X):</span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Perform standardization by centering and scaling."""</span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> np.array(X, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a>        X_normalisé <span class="op">=</span> np.zeros_like(X)        </span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a>            X_normalisé[:, j] <span class="op">=</span> (X[:, j] <span class="op">-</span> <span class="va">self</span>._mean[j])<span class="op">/</span><span class="va">self</span>._stdev[j]</span>
<span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X_normalisé</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="38d21886-ae46-4d5c-8115-85ebf8a64e01" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> knnClassifier():</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, k<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.k <span class="op">=</span> k</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_X <span class="op">=</span> <span class="va">None</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_y <span class="op">=</span> <span class="va">None</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Fit the nearest neighbors estimator from the training dataset."""</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_X <span class="op">=</span> np.array(X, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fit_y <span class="op">=</span> y</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X):</span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Predict the class labels for the provided data."""</span></span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> kNN(new_x):</span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">"""</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a><span class="co">            args:</span></span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a><span class="co">                X: jeu de données initiales</span></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="co">                y: classes associées aux éléments de X </span></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a><span class="co">                new_x: nouveau point que l'on souhaite classer</span></span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a><span class="co">                k: nombre de voisins pris dans l'évaluation</span></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a><span class="co">            return:</span></span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a><span class="co">                La classe de `y` la plus fréquente</span></span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a><span class="co">            """</span></span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a>            distances <span class="op">=</span> [math.dist(new_x, x) <span class="cf">for</span> x <span class="kw">in</span> <span class="va">self</span>._fit_X]</span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a>            plus_petites_distances <span class="op">=</span> <span class="bu">sorted</span>([(d, c) <span class="cf">for</span> (d,c) <span class="kw">in</span> <span class="op">\</span></span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a>                                             <span class="bu">zip</span>(distances, <span class="va">self</span>._fit_y)])[:<span class="va">self</span>.k]</span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a>            counter <span class="op">=</span> Counter([classe <span class="cf">for</span> _, classe <span class="kw">in</span> plus_petites_distances])</span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> counter.most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb211-31"><a href="#cb211-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb211-32"><a href="#cb211-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [kNN(x) <span class="cf">for</span> x <span class="kw">in</span> X]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sans-normalisation" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="sans-normalisation"><span class="header-section-number">4.2.1</span> Sans normalisation</h3>
<div id="8728ea93-8315-48e6-86b5-9d9dd5c1dc0c" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sans normalisation</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="co"># apprentissage</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> knnClassifier()</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>classifier.fit(X_train, y_train)</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inférence</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>y_test_predicted <span class="op">=</span> classifier.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quel est le taux d’erreur?</p>
<div id="80b841ef-f2fa-4d0e-bc21-50f136372201" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(y_test_predicted <span class="op">!=</span> y_test)<span class="op">/</span><span class="bu">len</span>(y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<pre><code>0.0859106529209622</code></pre>
</div>
</div>
</section>
<section id="avec-normalisation" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="avec-normalisation"><span class="header-section-number">4.2.2</span> Avec normalisation</h3>
<div id="4c74a895-050d-4b9f-afef-8bcc1fb7b9a6" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># avec normalisation</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> Scaler()</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>scaler.fit(X_train)</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>X_train_normalized <span class="op">=</span> scaler.transform(X_train)</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="co"># apprentissage</span></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> knnClassifier()</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>classifier.fit(X_train_normalized, y_train)</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a><span class="co"># inférence</span></span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>X_test_normalized <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a>y_test_predicted <span class="op">=</span> classifier.predict(X_test_normalized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8eb78042-5acd-4cec-a04a-331b965e00ec" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(y_test_predicted <span class="op">!=</span> y_test)<span class="op">/</span><span class="bu">len</span>(y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<pre><code>0.08247422680412371</code></pre>
</div>
</div>
<p>Différence légère sur le taux d’erreur.</p>
</section>
<section id="quelle-mesure-pour-la-pertinence-de-notre-algorithme" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="quelle-mesure-pour-la-pertinence-de-notre-algorithme"><span class="header-section-number">4.2.3</span> Quelle mesure pour la pertinence de notre algorithme?</h3>
<div id="3049bbbe-9e3c-4416-a348-bcaa164a244e" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>caravan.Purchase.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>0    5474
1     348
Name: Purchase, dtype: int64</code></pre>
</div>
</div>
<p>Le taux d’erreur KNN sur les 1 000 observations de test est d’un peu moins de 10%. À première vue, cela peut paraître plutôt bon. Cependant, étant donné qu’un peu plus de 6&nbsp;% des clients ont souscrit une assurance, nous pourrions réduire le taux d’erreur à près de 6&nbsp;% en prédisant toujours Non, quelles que soient les valeurs des prédicteurs&nbsp;! C’est ce qu’on appelle l’hypothèse nulle.}</p>
<p>Supposons qu’il y ait un coût non négligeable à tenter de vendre une assurance à un individu donné. Par exemple, un vendeur doit peut-être rendre visite à chaque client potentiel. Si l’entreprise tente de vendre de l’assurance à une sélection aléatoire de clients, le taux de réussite ne sera que de 6 %, ce qui pourrait être bien trop faible compte tenu des coûts impliqués. Au lieu de cela, l’entreprise aimerait essayer de vendre de l’assurance uniquement aux clients susceptibles de l’acheter. Le taux d’erreur global n’a donc aucun intérêt. Au lieu de cela, la fraction d’individus dont on prévoit correctement qu’ils souscriront une assurance est intéressante.</p>
<p>Comment mesurer ce taux?</p>
<div id="f3cd46ed-ec8e-4499-b856-f96b6055ac7f" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> confusion_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1434754a-70a0-4780-9f2b-d1748c35bb31" class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>confusion_table(y_test_predicted, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1063</td>
<td>74</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>22</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="320530a0-df88-4276-b706-921457cfaec7" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="op">/</span>(<span class="dv">22</span><span class="op">+</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>0.18518518518518517</code></pre>
</div>
</div>
<div id="8a237a4d-5fab-4cde-b8a8-32e70c7daedc" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clients choisis au hasard</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">74</span><span class="op">+</span><span class="dv">5</span>)<span class="op">/</span>(<span class="dv">74</span><span class="op">+</span><span class="dv">5</span><span class="op">+</span><span class="dv">1063</span><span class="op">+</span><span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>0.06786941580756013</code></pre>
</div>
</div>
<div id="c70dbd7c-a36b-4c24-904c-758a0f9eacf2" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">len</span>(y_test) <span class="op">==</span> <span class="dv">74</span><span class="op">+</span><span class="dv">5</span><span class="op">+</span><span class="dv">1063</span><span class="op">+</span><span class="dv">22</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="avec-scikit-learn" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="avec-scikit-learn"><span class="header-section-number">4.3</span> Avec scikit-learn</h2>
<section id="k1-sans-normalisation" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="k1-sans-normalisation"><span class="header-section-number">4.3.1</span> k=1 sans normalisation</h3>
<div id="0767fbb1-a31b-4fb3-a103-1de6b858c903" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="0b49e949-97e6-48ce-a0f4-c79bf07178d6" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># avec un seul voisin: k=1, sans normalisation</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>(X_train,</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a> X_test,</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a> y_train,</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a> y_test) <span class="op">=</span> train_test_split(X,</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>                            y,</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>                            test_size<span class="op">=</span><span class="dv">1164</span>,</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>knn1 <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>knn1_pred <span class="op">=</span> knn1.fit(X_train, y_train).predict(X_test)</span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>np.mean(y_test <span class="op">!=</span> knn1_pred), np.mean(y_test)</span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>confusion_table(knn1_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1021</td>
<td>69</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>66</td>
<td>8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="ae9976b2-b20f-48a7-a08d-551512b52d0d" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="op">/</span>(<span class="dv">66</span><span class="op">+</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>0.10810810810810811</code></pre>
</div>
</div>
</section>
<section id="k1-avec-normalisation" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="k1-avec-normalisation"><span class="header-section-number">4.3.2</span> k=1 avec normalisation</h3>
<div id="5941a023-176c-4452-817f-64d9f3cbd311" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># avec un seul voisin: k=1</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>scaler_sk <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>                        with_std<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>                        copy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>scaler_sk.fit(X)</span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>X_std <span class="op">=</span> scaler_sk.transform(X)</span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>(X_train,</span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a> X_test,</span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a> y_train,</span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a> y_test) <span class="op">=</span> train_test_split(X_std,</span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a>                            y,</span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a>                            test_size<span class="op">=</span><span class="dv">1164</span>,</span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a>knn1 <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a>X_test_std <span class="op">=</span> scaler_sk.transform(X_test)</span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a>knn1_pred <span class="op">=</span> knn1.fit(X_train, y_train).predict(X_test_std)</span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a>np.mean(y_test <span class="op">!=</span> knn1_pred), np.mean(y_test)</span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a>confusion_table(knn1_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1071</td>
<td>73</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>16</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="08fc535e-dda2-4e08-8ba3-47ffc03e0e22" class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="op">/</span>(<span class="dv">16</span><span class="op">+</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>0.2</code></pre>
</div>
</div>
</section>
<section id="k3-sans-normalisation" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="k3-sans-normalisation"><span class="header-section-number">4.3.3</span> k=3 sans normalisation</h3>
<div id="2dd3445c-1a72-41e3-98e6-7a2772e8aafc" class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>(X_train,</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a> X_test,</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a> y_train,</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a> y_test) <span class="op">=</span> train_test_split(X,</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>                            y,</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>                            test_size<span class="op">=</span><span class="dv">1164</span>,</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>knn3 <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>knn3_pred <span class="op">=</span> knn3.fit(X_train, y_train).predict(X_test)</span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>np.mean(y_test <span class="op">!=</span> knn3_pred), np.mean(y_test)</span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>confusion_table(knn3_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="136">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1072</td>
<td>77</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>15</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Bof, bof…</p>
</section>
<section id="k3-avec-normalisation" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="k3-avec-normalisation"><span class="header-section-number">4.3.4</span> k=3 avec normalisation</h3>
<div id="f57d2b23-9114-453f-843b-e1c0af3a562f" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>scaler_sk <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>                        with_std<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>                        copy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>scaler_sk.fit(X)</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>X_std <span class="op">=</span> scaler_sk.transform(X)</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>(X_train,</span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a> X_test,</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a> y_train,</span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a> y_test) <span class="op">=</span> train_test_split(X_std,</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>                            y,</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>                            test_size<span class="op">=</span><span class="dv">1164</span>,</span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>knn3 <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>X_test_std <span class="op">=</span> scaler_sk.transform(X_test)</span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>knn3_pred <span class="op">=</span> knn3.fit(X_train, y_train).predict(X_test_std)</span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>np.mean(y_test <span class="op">!=</span> knn3_pred), np.mean(y_test)</span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a>confusion_table(knn3_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1078</td>
<td>74</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>9</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="0e5d1da4-6de0-401f-b9f5-852be6726a75" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="op">/</span>(<span class="dv">9</span><span class="op">+</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="138">
<pre><code>0.25</code></pre>
</div>
</div>
<p>Meilleur score, mais peu d’éléments choisis.</p>
</section>
</section>
<section id="références-1" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="références-1"><span class="header-section-number">4.4</span> Références</h2>
<p><a href="https://islp.readthedocs.io/en/latest/labs/Ch04-classification-lab.html">Introduction to Statistical Learning with applications in Python: Logistic Regression, LDA, QDA, and KNN</a></p>
</section>
</section>
<section id="arbres-de-décision" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Arbres de décision</h1>
<p>decision trees</p>
<section id="création-du-jeu-de-données-exemple" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="création-du-jeu-de-données-exemple"><span class="header-section-number">5.1</span> Création du jeu de données exemple</h2>
<p>La vidéo dont est inspiré l’exemple: <a href="https://www.youtube.com/watch?v=wr9gUr-eWdA&amp;list=PLoROMvodv4rMiGQp3WXShtMGgzqpfVfbU&amp;index=11">Lecture 10 - Decision Trees and Ensemble Methods | Stanford CS229: Machine Learning (Autumn 2018)</a></p>
<p>toy dataset: <strong>y a-t-il de la neige pour aller skier?</strong></p>
<p>On définit un jeu de données simplifiées de zones propices au ski en fonction de la lattitude et du jour de l’année</p>
<p>Les conditions pour avoir de la neige sont définies comme suit:</p>
<p>hiver austral: - latitude &lt; -45 - mois juillet, août, septembre <span class="math inline">\(\iff jour \in [[180, 270]]\)</span></p>
<p>hiver boréal: - latitude &gt; 45 - mois novembre, décembre, janvier, février, mars, avril <span class="math inline">\(\iff jour \in [[305, 365]] ou [[0, 120]]]\)</span></p>
<p>Les points propices seront classés dans la classe <code>Vrai / Bleue</code>, les autres dans la classe <code>False / Rouge</code>.</p>
<div id="2adc72d0-e1b4-4f62-8519-89aa49a0b42b" class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>pôle_nord <span class="op">=</span> <span class="dv">90</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>pôle_sud <span class="op">=</span> <span class="op">-</span><span class="dv">90</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="39e0450a-9628-4382-805c-b099cca9f831" class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> namedtuple</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>Point <span class="op">=</span> namedtuple(<span class="st">'Point'</span>, <span class="st">'jour latitude'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="df6dc6f0-f4f6-4094-ad5f-9e210da274b2" class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> [Point(random.randint(<span class="dv">0</span>,<span class="dv">364</span>),random.randint(pôle_sud, pôle_nord)) <span class="op">\</span></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b5df1657-d62d-492d-95f2-3c17bcdffc60" class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>points[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>[Point(jour=327, latitude=-62),
 Point(jour=12, latitude=-20),
 Point(jour=125, latitude=-33),
 Point(jour=71, latitude=-64),
 Point(jour=346, latitude=49)]</code></pre>
</div>
</div>
<p>Equivalent à:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> []</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> random.randint(<span class="dv">0</span>,<span class="dv">364</span>)</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> random.randint(pôle_sud, pôle_nord)</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>    points.append(Point(x, y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="e8797f74-97ab-4e57-a525-30d69816ca8d" class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>abscisses <span class="op">=</span> [point.jour <span class="cf">for</span> point <span class="kw">in</span> points]</span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>ordonnées <span class="op">=</span> [point.latitude <span class="cf">for</span> point <span class="kw">in</span> points]</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Points considérés'</span>)</span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a>ax.scatter(abscisses, ordonnées, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-144-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>hiver austral: - latitude &lt; -45 - mois juillet, août, septembre <span class="math inline">\(\iff jour \in [[180, 270]]\)</span></p>
<p>hiver boréal: - latitude &gt; 45 - mois novembre, décembre, janvier, février, mars, avril <span class="math inline">\(\iff jour \in [[305, 365]] ou [[0, 120]]]\)</span></p>
<div id="a244e4b4-4bef-4403-8f86-a8ce4287a6d1" class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> []</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> point <span class="kw">in</span> points:</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> point.latitude<span class="op">&lt;-</span><span class="dv">45</span> <span class="kw">and</span> <span class="dv">180</span><span class="op">&lt;=</span>point.jour<span class="op">&lt;=</span><span class="dv">270</span>:</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>        y.append(<span class="va">True</span>)</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> point.latitude<span class="op">&gt;</span><span class="dv">45</span> <span class="kw">and</span> (<span class="dv">0</span><span class="op">&lt;=</span>point.jour<span class="op">&lt;=</span><span class="dv">120</span> <span class="kw">or</span> <span class="dv">305</span><span class="op">&lt;=</span>point.jour<span class="op">&lt;=</span><span class="dv">365</span>):</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>        y.append(<span class="va">True</span>)</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>        y.append(<span class="va">False</span>)</span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a>y[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<pre><code>[False, False, False, False, True]</code></pre>
</div>
</div>
<div id="b26069cf-b213-4c2f-86a9-3cc62d0c75f3" class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>points[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="145">
<pre><code>[Point(jour=327, latitude=-62),
 Point(jour=12, latitude=-20),
 Point(jour=125, latitude=-33),
 Point(jour=71, latitude=-64),
 Point(jour=346, latitude=49)]</code></pre>
</div>
</div>
<div id="58eab8db-1a9e-4057-8b71-280cc037f91e" class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 = bleu</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 = rouge</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>couleurs <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> y_i: <span class="st">'blue'</span> <span class="cf">if</span> y_i <span class="cf">else</span> <span class="st">'red'</span>, y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e06f37ae-dd1c-4046-a5e2-e0b8def8dfa4" class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>couleurs[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="147">
<pre><code>['red', 'red', 'red', 'red', 'blue']</code></pre>
</div>
</div>
<div id="5077b5f1-725a-42d1-8855-e2f552965a8d" class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Classification'</span>)</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(abscisses, ordonnées, c<span class="op">=</span>couleurs, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-149-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="représentation-graphique-des-premières-séparations" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="représentation-graphique-des-premières-séparations"><span class="header-section-number">5.2</span> Représentation graphique des premières séparations</h2>
<p>Critère de choix des séparations: avoir le plus de chance d’avoir des points bleus.</p>
<section id="région-condidérée-ensemble-des-points" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="région-condidérée-ensemble-des-points"><span class="header-section-number">5.2.1</span> Région condidérée: ensemble des points</h3>
<div id="b7d91295-7874-4a01-9b27-f0fa7321b6b6" class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Premier choix de séparation pour avoir le plus de chance d'avoir des points bleus</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="co"># latitude &gt; 45</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Région R en R1 et R2'</span>)</span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>ax.scatter(abscisses, ordonnées, c<span class="op">=</span>couleurs, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-150-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="région-r1-classée-en-bleu" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="région-r1-classée-en-bleu"><span class="header-section-number">5.2.2</span> Région R1 classée en bleu</h3>
<div id="181278df-cf3e-4b6f-9b80-9d0c8b26daa6" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'x_1'</span> : [point.jour <span class="cf">for</span> point <span class="kw">in</span> points],</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'x_2'</span> : [point.latitude <span class="cf">for</span> point <span class="kw">in</span> points],</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'y'</span>: y,</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'color'</span>: couleurs</span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>                 })</span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x_1</th>
<th data-quarto-table-cell-role="th">x_2</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">color</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>327</td>
<td>-62</td>
<td>False</td>
<td>red</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12</td>
<td>-20</td>
<td>False</td>
<td>red</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>125</td>
<td>-33</td>
<td>False</td>
<td>red</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>71</td>
<td>-64</td>
<td>False</td>
<td>red</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>346</td>
<td>49</td>
<td>True</td>
<td>blue</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><a href="https://pandas.pydata.org/docs/getting_started/intro_tutorials/03_subset_data.html">Sélection de lignes en fonction d’une valeur sur une colonne</a></p>
<div id="8d4a5e7f-209d-474c-b2ef-5e69dba2ea6a" class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>df_R1<span class="op">=</span> df[df.x_2 <span class="op">&gt;</span> <span class="dv">45</span>].copy()</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>df_R1.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="151">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x_1</th>
<th data-quarto-table-cell-role="th">x_2</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">color</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>346</td>
<td>49</td>
<td>True</td>
<td>blue</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>44</td>
<td>61</td>
<td>True</td>
<td>blue</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>258</td>
<td>64</td>
<td>False</td>
<td>red</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>13</td>
<td>53</td>
<td>True</td>
<td>blue</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>101</td>
<td>76</td>
<td>True</td>
<td>blue</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="3cdbfe3f-4a91-476b-aaa1-6a4c009cd7c5" class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Région R1 classée en bleu</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Région R1 classée en bleu'</span>)</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>ax.scatter(df_R1.x_1, df_R1.x_2, c<span class="op">=</span>df_R1.color, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>ax.fill_between(x<span class="op">=</span>[<span class="op">-</span><span class="dv">0</span>,<span class="dv">365</span>], y1<span class="op">=</span><span class="dv">45</span>, y2<span class="op">=</span><span class="dv">90</span>, color<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">.25</span>)</span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-153-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="région-r2-classée-en-rouge" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="région-r2-classée-en-rouge"><span class="header-section-number">5.2.3</span> Région R2 classée en rouge</h3>
<div id="05d03ceb-81e4-42a2-8cd3-eabddcd0d921" class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Région R2 classée en rouge</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>df_R2<span class="op">=</span> df[df.x_2 <span class="op">&lt;=</span> <span class="dv">45</span>]</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Région R2 classée en rouge'</span>)</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(df_R2.x_1, df_R2.x_2, c<span class="op">=</span>df_R2.color, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>ax.fill_between(x<span class="op">=</span>[<span class="op">-</span><span class="dv">0</span>,<span class="dv">365</span>], y1<span class="op">=-</span><span class="dv">90</span>, y2<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">.25</span>)</span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-154-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="arbre-de-hauteur-1" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="arbre-de-hauteur-1"><span class="header-section-number">5.2.4</span> Arbre de hauteur 1</h3>
<p>Algorithme d’un arbre de décision d’une hauteur de 1</p>
<div id="b0d3a3b1-267e-433d-978c-deefa8a6a185" class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arbre avec une hauteur = 1</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classification_h1(point):</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> point.latitude <span class="op">&gt;</span> <span class="dv">45</span>:</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ecriture équivalente:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classification_h1(point):</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> point.latitude <span class="op">&gt;</span> <span class="dv">45</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="5cc3837b-accc-4bc1-b99b-e4aba1fa7e39" class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R1</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>classification_h1(Point(<span class="dv">150</span>, <span class="dv">75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="155">
<pre><code>True</code></pre>
</div>
</div>
<div id="97b8dc16-9a73-415c-a2c1-fe18f0bcde9e" class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taux d'erreur dans R1 (point.latitude &gt; 45) zone classée en bleu</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="op">/</span>(<span class="dv">10</span><span class="op">+</span><span class="dv">9</span><span class="op">+</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="156">
<pre><code>0.36</code></pre>
</div>
</div>
<div id="ac38ae14-6c5a-4528-a114-13bc4cfa2cea" class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>df_R1.loc[df.y <span class="op">==</span> <span class="va">False</span>].shape[<span class="dv">0</span>]<span class="op">/</span>df_R1.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="157">
<pre><code>0.36</code></pre>
</div>
</div>
<div id="d143f79b-9841-4c0e-af32-a379ace146f7" class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R2</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>classification_h1(Point(<span class="dv">150</span>, <span class="op">-</span><span class="dv">75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="158">
<pre><code>False</code></pre>
</div>
</div>
<div id="d5079675-036b-4cec-b3f9-2181ca5323c8" class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taux d'erreur dans R2 (point.latitude &lt;= 45) zone classée en rouge</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>df_R2.loc[df.y <span class="op">==</span> <span class="va">True</span>].shape[<span class="dv">0</span>]<span class="op">/</span>df_R2.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="159">
<pre><code>0.08</code></pre>
</div>
</div>
<div id="1f8665fc-56d9-4782-8666-e053b539840f" class="cell" data-execution_count="160">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taux d'erreur sur l'ensemble du jeu de données</span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([classification_h1(point) <span class="op">!=</span> y[i] <span class="cf">for</span> i, point <span class="kw">in</span> <span class="bu">enumerate</span>(points)])<span class="op">/</span><span class="bu">len</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="160">
<pre><code>0.15</code></pre>
</div>
</div>
</section>
<section id="arbre-de-hauteur-2" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="arbre-de-hauteur-2"><span class="header-section-number">5.2.5</span> Arbre de hauteur 2</h3>
<p>Algorithme d’un arbre de décision d’une hauteur de 2</p>
<p>On travaille de manière récursive sur chacune des régions R1 et R2 définies</p>
<div id="518a4b56-f8a3-481c-b853-2d2380e6606d" class="cell" data-execution_count="161">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Second choix de séparation pour avoir le plus de chance d'avoir des points bleus</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="co"># jour &lt; 120</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Région R1'</span>)</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(df_R1.x_1, df_R1.x_2, c<span class="op">=</span>df_R1.color, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="dv">120</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-162-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="316ee3f3-bf1a-40e0-8e7b-9289d6fa44b1" class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Second choix de séparation pour avoir le plus de chance d'avoir des points bleus</span></span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="co"># jour &lt; 120</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> [<span class="dv">45</span>, <span class="dv">90</span>]</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a>ax.fill_betweenx(y1, <span class="dv">0</span>, <span class="dv">120</span>, facecolor<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a>ax.fill_betweenx(y1, <span class="dv">120</span>, <span class="dv">365</span>, facecolor<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Segmentation de la région R1'</span>)</span>
<span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a>ax.scatter(df_R1.x_1, df_R1.x_2, c<span class="op">=</span>df_R1.color, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb273-13"><a href="#cb273-13" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb273-14"><a href="#cb273-14" aria-hidden="true" tabindex="-1"></a>ax.axvline(x<span class="op">=</span><span class="dv">120</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb273-15"><a href="#cb273-15" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb273-16"><a href="#cb273-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-163-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f4151f1c-9851-4b39-9e52-62e40b7f92d8" class="cell" data-execution_count="163">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>df_R2<span class="op">=</span> df[df.x_2 <span class="op">&lt;=</span> <span class="dv">45</span>]</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Région R2'</span>)</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>ax.scatter(df_R2.x_1, df_R2.x_2, c<span class="op">=</span>df_R2.color, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=-</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb274-8"><a href="#cb274-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb274-9"><a href="#cb274-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb274-10"><a href="#cb274-10" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb274-11"><a href="#cb274-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-164-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9e84c123-6ba2-4104-b2ee-b42b8f0dfb09" class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>df_R2<span class="op">=</span> df[df.x_2 <span class="op">&lt;=</span> <span class="dv">45</span>]</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>ax.fill_between(x<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">365</span>], y1<span class="op">=-</span><span class="dv">90</span>, y2<span class="op">=-</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">.25</span>)</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>ax.fill_between(x<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">365</span>], y1<span class="op">=-</span><span class="dv">45</span>, y2<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">.25</span>)</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Segmentation de la région R2'</span>)</span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a>ax.scatter(df_R2.x_1, df_R2.x_2, c<span class="op">=</span>df_R2.color, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb275-9"><a href="#cb275-9" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb275-10"><a href="#cb275-10" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=-</span><span class="dv">45</span>, color<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb275-11"><a href="#cb275-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-12"><a href="#cb275-12" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'jour'</span>)</span>
<span id="cb275-13"><a href="#cb275-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'latitude'</span>)</span>
<span id="cb275-14"><a href="#cb275-14" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">95</span>, <span class="dv">95</span>)</span>
<span id="cb275-15"><a href="#cb275-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-165-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a530ac5d-287c-4a31-b060-7d12dd8d368b" class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arbre avec une hauteur = 2</span></span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classification_h2(point):</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> point.latitude <span class="op">&gt;</span> <span class="dv">45</span>:</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> point.jour <span class="op">&lt;</span> <span class="dv">120</span>:</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># point.latitude &lt;= 45</span></span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> point.latitude <span class="op">&lt;</span> <span class="op">-</span><span class="dv">45</span>:</span>
<span id="cb276-10"><a href="#cb276-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb276-11"><a href="#cb276-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb276-12"><a href="#cb276-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3cc564a3-ae41-4dba-8912-e34ddac316b0" class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arbre avec une hauteur = 2</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classification_h2(point):</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> point.latitude <span class="op">&gt;</span> <span class="dv">45</span>:</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> point.jour <span class="op">&lt;</span> <span class="dv">120</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># point.latitude &lt;= 45</span></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> point.latitude <span class="op">&lt;</span> <span class="op">-</span><span class="dv">45</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="698934ad-ad54-40b8-b42d-d1b4381c7034" class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>classification_h2(Point(<span class="dv">150</span>, <span class="op">-</span><span class="dv">75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="167">
<pre><code>True</code></pre>
</div>
</div>
<div id="fbb1b2e0-4b26-4588-91b6-9bc0a6b3c113" class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taux d'erreur sur l'ensemble du jeu de données</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7c146a0d-2e2d-4a68-a000-cdec62bccee2" class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>([classification_h2(point) <span class="op">!=</span> y[i] <span class="cf">for</span> i, point <span class="kw">in</span> <span class="bu">enumerate</span>(points)])<span class="op">/</span><span class="bu">len</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="169">
<pre><code>0.28</code></pre>
</div>
</div>
</section>
</section>
<section id="classification-avec-scikit-learn" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="classification-avec-scikit-learn"><span class="header-section-number">5.3</span> Classification avec scikit learn</h2>
<p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">Classifieur par arbre de décision</a></p>
<p><a href="https://mljar.com/blog/visualize-decision-tree/">Visualize a Decision Tree</a></p>
<div id="1f9c5fac-1d13-4359-b250-b64a7c98ccc1" class="cell" data-execution_count="170">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier </span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the classifier with default hyper-parameters</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a><span class="co"># clf = DecisionTreeClassifier(random_state=1234)</span></span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">1234</span>)</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> points</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> clf.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b557c794-c7a5-47f1-91ce-4b4774767985" class="cell" data-execution_count="171">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>text_representation <span class="op">=</span> tree.export_text(clf)</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(text_representation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>|--- feature_1 &lt;= 42.50
|   |--- feature_1 &lt;= -62.50
|   |   |--- class: False
|   |--- feature_1 &gt;  -62.50
|   |   |--- class: False
|--- feature_1 &gt;  42.50
|   |--- feature_0 &lt;= 121.00
|   |   |--- class: True
|   |--- feature_0 &gt;  121.00
|   |   |--- class: False
</code></pre>
</div>
</div>
<div id="aae7b7c9-395c-4ce6-907d-fa66d3e7450f" class="cell" data-execution_count="172">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arbre de hauteur max_depth=2</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> tree.plot_tree(clf, </span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>                   feature_names<span class="op">=</span>[<span class="st">'jour'</span>, <span class="st">'latitude'</span>],  </span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>                   class_names<span class="op">=</span>[<span class="st">'pas de ski'</span>, <span class="st">'ski'</span>],</span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-173-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="4546832b-67c4-4189-bada-9ba781cb7dac" class="cell" data-execution_count="173">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arbre de hauteur maximale max_depth=None</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">1234</span>)</span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> points</span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> clf.fit(X, y)</span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="fl">12.8</span>,<span class="fl">9.6</span>))</span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> tree.plot_tree(clf, </span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>                   feature_names<span class="op">=</span>[<span class="st">'jour'</span>, <span class="st">'latitude'</span>],  </span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a>                   class_names<span class="op">=</span>[<span class="st">'pas de ski'</span>, <span class="st">'ski'</span>],</span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a>                   filled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="init-ml-to-html_files/figure-html/cell-174-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Est-ce qu’un nouveau point est bien classé par notre algo?</p>
</section>
</section>
<section id="application-des-arbres-de-décision-à-un-vrai-jeu-de-données" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Application des arbres de décision à un vrai jeu de données</h1>
<p>Peut-on prédire si un client va acheter une assurance ou pas?</p>
<p><a href="https://islp.readthedocs.io/en/latest/datasets/Caravan.html">dataset Caravan</a></p>
<p>Nous allons utiliser un <a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">Classifieur par arbre de décision</a> et comparer les résultats avec kNN.</p>
<p>Le but est d’avoir au final l’algorithme le plus performant pour répondre à notre problématique.</p>
<section id="classification-de-référence-baseline" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="classification-de-référence-baseline"><span class="header-section-number">6.1</span> Classification de référence (baseline)</h2>
<div id="d680d4fe-1d38-46c0-bf4f-94e44196862d" class="cell" data-execution_count="174">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> confusion_table</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Utiliser un <a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">Classifieur par arbre de décision</a> en laissant les paramètres par défaut de sklearn.</p>
<p>Afficher la table de confusion pour l’évaluation du jeu de test.</p>
<div id="91b84745-0a3d-4f4a-a661-da88f69d7c5f" class="cell" data-execution_count="175">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>caravan <span class="op">=</span> load_data(<span class="st">'Caravan'</span>)</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> caravan.Purchase.<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x<span class="op">==</span><span class="st">'Yes'</span> <span class="cf">else</span> <span class="dv">0</span>)  <span class="co"># Pour les métriques de scikit learn</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> caravan.drop(columns<span class="op">=</span>[<span class="st">'Purchase'</span>])</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>(X_train,</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a> X_test,</span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a> y_train,</span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a> y_test) <span class="op">=</span> train_test_split(X,</span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a>                            y,</span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a>                            test_size<span class="op">=</span><span class="dv">1164</span>,</span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-14"><a href="#cb289-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-15"><a href="#cb289-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-16"><a href="#cb289-16" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb289-17"><a href="#cb289-17" aria-hidden="true" tabindex="-1"></a>classifier.fit(X_train, y_train)</span>
<span id="cb289-18"><a href="#cb289-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-19"><a href="#cb289-19" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb289-20"><a href="#cb289-20" aria-hidden="true" tabindex="-1"></a>confusion_table(y_test_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="175">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1015</td>
<td>64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>72</td>
<td>13</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Calculer le score de notre métrique: tp/(tp+fp)</p>
<div id="9ff11d6c-908a-441d-a54b-322abf6d4428" class="cell" data-execution_count="176">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span><span class="op">/</span>(<span class="dv">13</span><span class="op">+</span><span class="dv">72</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="176">
<pre><code>0.15294117647058825</code></pre>
</div>
</div>
<p>15,3%: pas encore mieux que knn où l’on atteignait 15,8%</p>
<p>Quel est l’effet de la normalisation avant l’entraînement d’un arbre de décision?</p>
<p>La normalisation n’est pas utile pour les arbres de décision</p>
<p>Définition d’une fonction pour mesurer notre métrique:</p>
<div id="c11c27cf-832d-430f-ba6f-ac16ab72a627" class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_test_pred)  <span class="co"># ! inversé par rapport à la fonction de ISLP</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>cm <span class="co"># ! affichage transposé par rapport à celui de ISLP</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="177">
<pre><code>array([[1015,   72],
       [  64,   13]])</code></pre>
</div>
</div>
<div id="d13ce52e-8554-4417-b2e1-3c78544a83ba" class="cell" data-execution_count="178">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>fp <span class="op">=</span> cm[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>tp <span class="op">=</span> cm[<span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>tp<span class="op">/</span>(tp<span class="op">+</span>fp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="178">
<pre><code>0.15294117647058825</code></pre>
</div>
</div>
<p>Définition d’une fonction pour mesurer notre métrique:</p>
<div id="7ceb9d3b-9adf-4484-a600-3437358a1b75" class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="co"># La valeur prédictive positive : Positive predictive value (PPV), precision</span></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> metric(y_true, y_pred):</span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> cm[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>    tp <span class="op">=</span> cm[<span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb296-9"><a href="#cb296-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tp<span class="op">/</span>(tp<span class="op">+</span>fp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="45917123-6410-4779-ae00-47712273b69b" class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>metric(y_test, y_test_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="180">
<pre><code>0.15294117647058825</code></pre>
</div>
</div>
<p>Métrique classique appelée la valeur prédictive positive (en anglais: <code>Positive predictive value (PPV), precision</code>)</p>
<div id="e2104a28-16a3-42c3-a05e-e82a68688835" class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>precision_score(y_test, y_test_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="181">
<pre><code>0.15294117647058825</code></pre>
</div>
</div>
</section>
<section id="exploration-des-hyperparamètres" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="exploration-des-hyperparamètres"><span class="header-section-number">6.2</span> Exploration des hyperparamètres</h2>
<p>On peut ensuite faire une exploration des hyperparamètres pour essayer d’améliorer ce résultat.</p>
<p>Paramètres de la fonction <a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html">DecisionTreeClassifier</a> de scikit-learn à explorer (a minima): - criterion - max_depth</p>
<p>Quelle est la meilleur combinaison d’hyperparamètres?</p>
<div id="ad191295-f9de-4c37-af22-3cefc1a5ea36" class="cell" data-execution_count="182">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>criterions <span class="op">=</span>[<span class="st">'gini'</span>, <span class="st">'entropy'</span>, <span class="st">'log_loss'</span>]</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>max_depths <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="va">None</span>]</span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> criterion <span class="kw">in</span> criterions:</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> max_depth <span class="kw">in</span> max_depths:</span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>        classifier <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span>criterion,</span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>                                            max_depth<span class="op">=</span>max_depth,</span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>                                            random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>        classifier.fit(X_train, y_train)</span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>        y_test_pred <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb301-13"><a href="#cb301-13" aria-hidden="true" tabindex="-1"></a>        results.append((precision_score(y_test, y_test_pred), criterion, max_depth))</span>
<span id="cb301-14"><a href="#cb301-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-15"><a href="#cb301-15" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="182">
<pre><code>[(0.08, 'entropy', 10),
 (0.08, 'log_loss', 10),
 (0.15294117647058825, 'gini', None),
 (0.16216216216216217, 'entropy', None),
 (0.16216216216216217, 'log_loss', None),
 (0.1694915254237288, 'gini', 15),
 (0.17142857142857143, 'entropy', 20),
 (0.17142857142857143, 'log_loss', 20),
 (0.17307692307692307, 'entropy', 15),
 (0.17307692307692307, 'log_loss', 15),
 (0.17647058823529413, 'entropy', 5),
 (0.17647058823529413, 'log_loss', 5),
 (0.18181818181818182, 'gini', 20),
 (0.22727272727272727, 'gini', 10),
 (0.2857142857142857, 'gini', 5),
 (0.3333333333333333, 'entropy', 3),
 (0.3333333333333333, 'log_loss', 3),
 (0.375, 'gini', 3)]</code></pre>
</div>
</div>
<div id="8bfd23f7-caae-41b3-a08b-a468b01827a2" class="cell" data-execution_count="183">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span><span class="st">'entropy'</span>, max_depth<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>classifier.fit(X_train, y_train)</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>confusion_table(y_test_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="183">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1085</td>
<td>76</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>On a certes un bon score, mais très peu de valeurs sélectionnées. Pour réussir à vendre nos contrats d’assurance, c’est pas terrible.</p>
<p>Si on veut que nos commerciaux aient un nombre suffisant de prospects à appeler il faudrait contraindre notre solution a choisir un algorithme qui renvoit un nombre suffisant de résultats prédits positifs.</p>
<p>Disons au minium <code>19</code>, ce qu’on avait avec knn.</p>
<p>Quelle est dans ce cas la meilleur combinaison d’hyperparamètres?</p>
<div id="81a61247-0adc-4958-a46c-cf9dfdba979d" class="cell" data-execution_count="184">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>criterions <span class="op">=</span>[<span class="st">'gini'</span>, <span class="st">'entropy'</span>, <span class="st">'log_loss'</span>]</span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>max_depths <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="va">None</span>]</span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> criterion <span class="kw">in</span> criterions:</span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> max_depth <span class="kw">in</span> max_depths:</span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a>        classifier <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span>criterion,</span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a>                                            max_depth<span class="op">=</span>max_depth,</span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a>                                            random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb304-10"><a href="#cb304-10" aria-hidden="true" tabindex="-1"></a>        classifier.fit(X_train, y_train)</span>
<span id="cb304-11"><a href="#cb304-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb304-12"><a href="#cb304-12" aria-hidden="true" tabindex="-1"></a>        y_test_pred <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb304-13"><a href="#cb304-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">sum</span>(y_test_pred) <span class="op">&gt;=</span> <span class="dv">19</span>:</span>
<span id="cb304-14"><a href="#cb304-14" aria-hidden="true" tabindex="-1"></a>            results.append((precision_score(y_test, y_test_pred), criterion, max_depth))</span>
<span id="cb304-15"><a href="#cb304-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-16"><a href="#cb304-16" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="184">
<pre><code>[(0.08, 'entropy', 10),
 (0.08, 'log_loss', 10),
 (0.15294117647058825, 'gini', None),
 (0.16216216216216217, 'entropy', None),
 (0.16216216216216217, 'log_loss', None),
 (0.1694915254237288, 'gini', 15),
 (0.17142857142857143, 'entropy', 20),
 (0.17142857142857143, 'log_loss', 20),
 (0.17307692307692307, 'entropy', 15),
 (0.17307692307692307, 'log_loss', 15),
 (0.18181818181818182, 'gini', 20),
 (0.22727272727272727, 'gini', 10)]</code></pre>
</div>
</div>
</section>
<section id="meilleur-résultat" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="meilleur-résultat"><span class="header-section-number">6.3</span> Meilleur résultat</h2>
<div id="3c254230-8266-4718-b27b-61c5625822ab" class="cell" data-execution_count="185">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span><span class="st">'gini'</span>, max_depth<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>classifier.fit(X_train, y_train)</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>confusion_table(y_test_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="185">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1053</td>
<td>67</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>34</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="ac3b15de-3d9b-4b52-93d9-b7db76a17915" class="cell" data-execution_count="186">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>precision_score(y_test, y_test_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="186">
<pre><code>0.22727272727272727</code></pre>
</div>
</div>
</section>
<section id="affinons-la-solution" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="affinons-la-solution"><span class="header-section-number">6.4</span> Affinons la solution</h2>
<p>Est-il possible d’améliorer le résultat obtenu?</p>
<div id="fc2070a8-44f7-4603-bc99-542d2daf20b5" class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>criterion<span class="op">=</span><span class="st">'gini'</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>max_depths <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">7</span>,<span class="dv">15</span>))</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> max_depth <span class="kw">in</span> max_depths:</span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>    classifier <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span>criterion,</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>                                        max_depth<span class="op">=</span>max_depth,</span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>                                        random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>    classifier.fit(X_train, y_train)</span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a>    y_test_pred <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb309-12"><a href="#cb309-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">sum</span>(y_test_pred) <span class="op">&gt;=</span> <span class="dv">19</span>:</span>
<span id="cb309-13"><a href="#cb309-13" aria-hidden="true" tabindex="-1"></a>        results.append((precision_score(y_test, y_test_pred), criterion, max_depth))</span>
<span id="cb309-14"><a href="#cb309-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-15"><a href="#cb309-15" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="187">
<pre><code>[(0.2222222222222222, 'gini', 11),
 (0.2222222222222222, 'gini', 14),
 (0.22448979591836735, 'gini', 12),
 (0.22727272727272727, 'gini', 10),
 (0.24528301886792453, 'gini', 13),
 (0.25, 'gini', 7),
 (0.25, 'gini', 9),
 (0.2727272727272727, 'gini', 8)]</code></pre>
</div>
</div>
<div id="90c5ffda-1d78-4f8e-b114-59ebcc7e7c8b" class="cell" data-execution_count="188">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>classifier <span class="op">=</span> DecisionTreeClassifier(criterion<span class="op">=</span><span class="st">'gini'</span>, max_depth<span class="op">=</span><span class="dv">8</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>classifier.fit(X_train, y_train)</span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> classifier.predict(X_test)</span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'valeur prédictive positive: </span><span class="sc">{0:0.0f}</span><span class="st"> %'</span>.<span class="bu">format</span>(precision_score(y_test,</span>
<span id="cb311-6"><a href="#cb311-6" aria-hidden="true" tabindex="-1"></a>                                                                      y_test_pred)<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb311-7"><a href="#cb311-7" aria-hidden="true" tabindex="-1"></a>confusion_table(y_test_pred, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>valeur prédictive positive: 27 %</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="188">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1071</td>
<td>71</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>16</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>